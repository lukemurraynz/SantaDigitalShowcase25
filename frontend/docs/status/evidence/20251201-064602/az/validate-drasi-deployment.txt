
═══════════════════════════════════════════════════════════
  ?? Drasi Deployment Validation
═══════════════════════════════════════════════════════════
  Resource Group: rg-qab
  Project: drasicrhsith
  Environment: qab
  Prefix: drasicrhsith-qab
  Namespace: drasi-system
═══════════════════════════════════════════════════════════

1??  Checking Kubernetes cluster connectivity...
   ? Kubernetes cluster accessible

2??  Validating Cosmos DB secrets...
   ? Cosmos DB secret configured for Managed Identity (endpoint only)
   ? Endpoint format valid: https://drasicrhsith-qab-cosmos.documents.azure.com:443/

2??  Validating Cosmos DB authentication (Managed Identity preferred)...
   ?? Managed Identity not detected; validating secret (fallback)
   ? Cosmos DB secret configured for Managed Identity (endpoint only)

3??  Validating Dapr component configuration...

4??  Checking Drasi pod health...
   ? Pod drasi-api-67ff9cbf55-wzf4r container daprd ready
   ? Pod drasi-api-67ff9cbf55-wzf4r container drasi-api ready
   ? Pod drasi-mongo-0 container mongo ready
   ? Pod drasi-redis-0 container redis ready
   ? Pod drasi-resource-provider-58db46cb66-l4k9q container daprd ready
   ? Pod drasi-resource-provider-58db46cb66-l4k9q container kubernetes-provider ready

5??  Checking Drasi CRD installation...

6??  Verifying Cosmos DB resources in Azure...
   ? Cosmos DB account exists: drasicrhsith-qab-cosmos

7??  Verifying resource name consistency...
   ? CosmosDB found: drasicrhsith-qab-cosmos
   ? AKS found: drasicrhsith-qab-aks
   ? EventHub found: drasicrhsith-qab-eh
   ? ContainerApp found: drasicrhsith-qab-api

═══════════════════════════════════════════════════════════
  ?? Validation Summary
═══════════════════════════════════════════════════════════

  ??  WARNINGS (12):
     ??  cosmos-state component not found in namespace drasi-system
        Component will be created by apply-drasi-resources.ps1
     ??  Pod default-publish-api-7997dbd966-xsg95 container daprd not ready
     ??  Pod default-publish-api-7997dbd966-xsg95 container publish-api not ready
     ??  Pod default-query-host-6648c44f9-cqnmv container daprd not ready
     ??  Pod default-query-host-6648c44f9-cqnmv container query-host not ready
     ??  Pod default-view-svc-59cc5cf78b-c64fq container daprd not ready
     ??  Pod default-view-svc-59cc5cf78b-c64fq container view-svc not ready
     ??  Pod drasi-mongo-init-qzdsx container mongo-init not ready
     ??  Missing Drasi CRDs: continuousqueries.drasi.io, sources.drasi.io, reactions.drasi.io
        CRDs will be installed by Drasi control plane initialization
        If pods are running but CRDs missing, check: kubectl logs -n drasi-system <drasi-api-pod>

  ? ERRORS (9):
     ? Pod default-publish-api-7997dbd966-xsg95 container daprd in CrashLoopBackOff state!
        Check logs: kubectl logs -n drasi-system default-publish-api-7997dbd966-xsg95 -c daprd
        Recent logs: time="2025-11-30T17:46:29.223442338Z" level=info msg="starting Dapr Runtime -- version 1.9.0 -- commit fdce5f1f1b76012291c888113169aee845f25ef8" app_id=default-publish-api instance=default-publish-api-7997dbd966-xsg95 scope=dapr.runtime type=log ver=1.9.0 | time="2025-11-30T17:46:29.223512133Z" level=info msg="log level set to: info" app_id=default-publish-api instance=default-publish-api-7997dbd966-xsg95 scope=dapr.runtime type=log ver=1.9.0 | time="2025-11-30T17:46:29.223628387Z" level=info msg="metrics server started on :9090/" app_id=default-publish-api instance=default-publish-api-7997dbd966-xsg95 scope=dapr.metrics type=log ver=1.9.0 | time="2025-11-30T17:46:29.22393007Z" level=fatal msg="couldn't find cert chain in environment variable DAPR_CERT_CHAIN" app_id=default-publish-api instance=default-publish-api-7997dbd966-xsg95 scope=dapr.runtime type=log ver=1.9.0
     ? Pod default-query-host-6648c44f9-cqnmv container daprd in CrashLoopBackOff state!
        Check logs: kubectl logs -n drasi-system default-query-host-6648c44f9-cqnmv -c daprd
        Recent logs: time="2025-11-30T17:46:29.223816704Z" level=info msg="starting Dapr Runtime -- version 1.9.0 -- commit fdce5f1f1b76012291c888113169aee845f25ef8" app_id=default-query-host instance=default-query-host-6648c44f9-cqnmv scope=dapr.runtime type=log ver=1.9.0 | time="2025-11-30T17:46:29.223844023Z" level=info msg="log level set to: info" app_id=default-query-host instance=default-query-host-6648c44f9-cqnmv scope=dapr.runtime type=log ver=1.9.0 | time="2025-11-30T17:46:29.223921586Z" level=info msg="metrics server started on :9090/" app_id=default-query-host instance=default-query-host-6648c44f9-cqnmv scope=dapr.metrics type=log ver=1.9.0 | time="2025-11-30T17:46:29.223999338Z" level=fatal msg="couldn't find cert chain in environment variable DAPR_CERT_CHAIN" app_id=default-query-host instance=default-query-host-6648c44f9-cqnmv scope=dapr.runtime type=log ver=1.9.0
     ? Pod default-view-svc-59cc5cf78b-c64fq container daprd in CrashLoopBackOff state!
        Check logs: kubectl logs -n drasi-system default-view-svc-59cc5cf78b-c64fq -c daprd
        Recent logs: time="2025-11-30T17:46:29.448362008Z" level=info msg="starting Dapr Runtime -- version 1.9.0 -- commit fdce5f1f1b76012291c888113169aee845f25ef8" app_id=default-view-svc instance=default-view-svc-59cc5cf78b-c64fq scope=dapr.runtime type=log ver=1.9.0 | time="2025-11-30T17:46:29.448390685Z" level=info msg="log level set to: info" app_id=default-view-svc instance=default-view-svc-59cc5cf78b-c64fq scope=dapr.runtime type=log ver=1.9.0 | time="2025-11-30T17:46:29.448460724Z" level=info msg="metrics server started on :9090/" app_id=default-view-svc instance=default-view-svc-59cc5cf78b-c64fq scope=dapr.metrics type=log ver=1.9.0 | time="2025-11-30T17:46:29.448573134Z" level=fatal msg="couldn't find cert chain in environment variable DAPR_CERT_CHAIN" app_id=default-view-svc instance=default-view-svc-59cc5cf78b-c64fq scope=dapr.runtime type=log ver=1.9.0

  ?? To fix issues automatically, run:
     .\scripts\fix-drasi-deployment.ps1 -ResourceGroup rg-qab -Project drasicrhsith -Env qab


