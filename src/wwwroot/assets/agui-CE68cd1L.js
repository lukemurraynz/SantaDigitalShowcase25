import{o as k,d as Ke,u as gt,a as X,b as Z,s as d,l as S,n as dr,c as fr,r as _n,e as st,Z as vr,_ as He,f as at,g as ot,h as ie,i as hr,j as In,k as Ye,m as pr,p as Er,q as bn,t as wn}from"./copilot-D723g8Ud.js";import"./react-BSeQcPOp.js";var mr=k({name:d(),arguments:d()}),gr=k({id:d(),type:S("function"),function:mr}),$e=k({id:d(),role:d(),content:d().optional(),name:d().optional()}),Sr=k({type:S("text"),text:d()}),An=k({type:S("binary"),mimeType:d(),id:d().optional(),url:d().optional(),data:d().optional(),filename:d().optional()}),yn=(e,n)=>{!e.id&&!e.url&&!e.data&&n.addIssue({code:vr.custom,message:"BinaryInputContent requires at least one of id, url, or data.",path:["id"]})},qa=An.superRefine((e,n)=>{yn(e,n)}),Tr=Ke("type",[Sr,An]),_r=Tr.superRefine((e,n)=>{e.type==="binary"&&yn(e,n)}),Ir=$e.extend({role:S("developer"),content:d()}),br=$e.extend({role:S("system"),content:d()}),wr=$e.extend({role:S("assistant"),content:d().optional(),toolCalls:Z(gr).optional()}),Ar=$e.extend({role:S("user"),content:gt([d(),Z(_r)])}),yr=k({id:d(),content:d(),role:S("tool"),toolCallId:d(),error:d().optional()}),Nr=k({id:d(),role:S("activity"),activityType:d(),content:_n(X())}),Nn=Ke("role",[Ir,br,wr,Ar,yr,Nr]),Za=gt([S("developer"),S("system"),S("assistant"),S("user"),S("tool"),S("activity")]),Cr=k({description:d(),value:d()}),Or=k({name:d(),description:d(),parameters:X()}),Rr=k({threadId:d(),runId:d(),parentRunId:d().optional(),state:X(),messages:Z(Nn),tools:Z(Or),context:Z(Cr),forwardedProps:X()}),xr=X(),P=class extends Error{constructor(e){super(e)}},yt=class extends P{constructor(){super("Connect not implemented. This method is not supported by the current agent.")}},Cn=gt([S("developer"),S("system"),S("assistant"),S("user")]),c=(e=>(e.TEXT_MESSAGE_START="TEXT_MESSAGE_START",e.TEXT_MESSAGE_CONTENT="TEXT_MESSAGE_CONTENT",e.TEXT_MESSAGE_END="TEXT_MESSAGE_END",e.TEXT_MESSAGE_CHUNK="TEXT_MESSAGE_CHUNK",e.THINKING_TEXT_MESSAGE_START="THINKING_TEXT_MESSAGE_START",e.THINKING_TEXT_MESSAGE_CONTENT="THINKING_TEXT_MESSAGE_CONTENT",e.THINKING_TEXT_MESSAGE_END="THINKING_TEXT_MESSAGE_END",e.TOOL_CALL_START="TOOL_CALL_START",e.TOOL_CALL_ARGS="TOOL_CALL_ARGS",e.TOOL_CALL_END="TOOL_CALL_END",e.TOOL_CALL_CHUNK="TOOL_CALL_CHUNK",e.TOOL_CALL_RESULT="TOOL_CALL_RESULT",e.THINKING_START="THINKING_START",e.THINKING_END="THINKING_END",e.STATE_SNAPSHOT="STATE_SNAPSHOT",e.STATE_DELTA="STATE_DELTA",e.MESSAGES_SNAPSHOT="MESSAGES_SNAPSHOT",e.ACTIVITY_SNAPSHOT="ACTIVITY_SNAPSHOT",e.ACTIVITY_DELTA="ACTIVITY_DELTA",e.RAW="RAW",e.CUSTOM="CUSTOM",e.RUN_STARTED="RUN_STARTED",e.RUN_FINISHED="RUN_FINISHED",e.RUN_ERROR="RUN_ERROR",e.STEP_STARTED="STEP_STARTED",e.STEP_FINISHED="STEP_FINISHED",e))(c||{}),x=k({type:fr(c),timestamp:dr().optional(),rawEvent:X().optional()}),kr=x.extend({type:S("TEXT_MESSAGE_START"),messageId:d(),role:Cn.default("assistant")}),On=x.extend({type:S("TEXT_MESSAGE_CONTENT"),messageId:d(),delta:d().refine(e=>e.length>0,"Delta must not be an empty string")}),Mr=x.extend({type:S("TEXT_MESSAGE_END"),messageId:d()}),Lr=x.extend({type:S("TEXT_MESSAGE_CHUNK"),messageId:d().optional(),role:Cn.optional(),delta:d().optional()}),Pr=x.extend({type:S("THINKING_TEXT_MESSAGE_START")}),Dr=On.omit({messageId:!0,type:!0}).extend({type:S("THINKING_TEXT_MESSAGE_CONTENT")}),Gr=x.extend({type:S("THINKING_TEXT_MESSAGE_END")}),Ur=x.extend({type:S("TOOL_CALL_START"),toolCallId:d(),toolCallName:d(),parentMessageId:d().optional()}),Hr=x.extend({type:S("TOOL_CALL_ARGS"),toolCallId:d(),delta:d()}),Fr=x.extend({type:S("TOOL_CALL_END"),toolCallId:d()}),Br=x.extend({messageId:d(),type:S("TOOL_CALL_RESULT"),toolCallId:d(),content:d(),role:S("tool").optional()}),Xr=x.extend({type:S("TOOL_CALL_CHUNK"),toolCallId:d().optional(),toolCallName:d().optional(),parentMessageId:d().optional(),delta:d().optional()}),Vr=x.extend({type:S("THINKING_START"),title:d().optional()}),Kr=x.extend({type:S("THINKING_END")}),$r=x.extend({type:S("STATE_SNAPSHOT"),snapshot:xr}),Jr=x.extend({type:S("STATE_DELTA"),delta:Z(X())}),zr=x.extend({type:S("MESSAGES_SNAPSHOT"),messages:Z(Nn)}),Yr=x.extend({type:S("ACTIVITY_SNAPSHOT"),messageId:d(),activityType:d(),content:_n(X()),replace:st().optional().default(!0)}),Wr=x.extend({type:S("ACTIVITY_DELTA"),messageId:d(),activityType:d(),patch:Z(X())}),qr=x.extend({type:S("RAW"),event:X(),source:d().optional()}),Zr=x.extend({type:S("CUSTOM"),name:d(),value:X()}),Qr=x.extend({type:S("RUN_STARTED"),threadId:d(),runId:d(),parentRunId:d().optional(),input:Rr.optional()}),jr=x.extend({type:S("RUN_FINISHED"),threadId:d(),runId:d(),result:X().optional()}),es=x.extend({type:S("RUN_ERROR"),message:d(),code:d().optional()}),ts=x.extend({type:S("STEP_STARTED"),stepName:d()}),ns=x.extend({type:S("STEP_FINISHED"),stepName:d()}),Rn=Ke("type",[kr,On,Mr,Lr,Vr,Kr,Pr,Dr,Gr,Ur,Hr,Fr,Xr,Br,$r,Jr,zr,Yr,Wr,qr,Zr,Qr,jr,es,ts,ns]);function G(e){return typeof e=="function"}function rs(e){return G(e?.lift)}function W(e){return function(n){if(rs(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}var xn=(function(e){return e&&typeof e.length=="number"&&typeof e!="function"});function kn(e){return G(e?.then)}function St(e){var n=function(r){Error.call(r),r.stack=new Error().stack},t=e(n);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var We=St(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,s){return s+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function it(e,n){if(e){var t=e.indexOf(n);0<=t&&e.splice(t,1)}}var Je=(function(){function e(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var n,t,r,s,a;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var i=He(o),l=i.next();!l.done;l=i.next()){var u=l.value;u.remove(this)}}catch(f){n={error:f}}finally{try{l&&!l.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}else o.remove(this);var _=this.initialTeardown;if(G(_))try{_()}catch(f){a=f instanceof We?f.errors:[f]}var w=this._finalizers;if(w){this._finalizers=null;try{for(var I=He(w),g=I.next();!g.done;g=I.next()){var v=g.value;try{Nt(v)}catch(f){a=a??[],f instanceof We?a=at(at([],ot(a)),ot(f.errors)):a.push(f)}}}catch(f){r={error:f}}finally{try{g&&!g.done&&(s=I.return)&&s.call(I)}finally{if(r)throw r.error}}}if(a)throw new We(a)}},e.prototype.add=function(n){var t;if(n&&n!==this)if(this.closed)Nt(n);else{if(n instanceof e){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(n)}},e.prototype._hasParent=function(n){var t=this._parentage;return t===n||Array.isArray(t)&&t.includes(n)},e.prototype._addParent=function(n){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n},e.prototype._removeParent=function(n){var t=this._parentage;t===n?this._parentage=null:Array.isArray(t)&&it(t,n)},e.prototype.remove=function(n){var t=this._finalizers;t&&it(t,n),n instanceof e&&n._removeParent(this)},e.EMPTY=(function(){var n=new e;return n.closed=!0,n})(),e})(),Mn=Je.EMPTY;function Ln(e){return e instanceof Je||e&&"closed"in e&&G(e.remove)&&G(e.add)&&G(e.unsubscribe)}function Nt(e){G(e)?e():e.unsubscribe()}var ss={Promise:void 0},as={setTimeout:function(e,n){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setTimeout.apply(void 0,at([e,n],ot(t)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function Pn(e){as.setTimeout(function(){throw e})}function Ct(){}function he(e){e()}var Tt=(function(e){ie(n,e);function n(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,Ln(t)&&t.add(r)):r.destination=ls,r}return n.create=function(t,r,s){return new lt(t,r,s)},n.prototype.next=function(t){this.isStopped||this._next(t)},n.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},n.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(t){this.destination.next(t)},n.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n})(Je),os=(function(){function e(n){this.partialObserver=n}return e.prototype.next=function(n){var t=this.partialObserver;if(t.next)try{t.next(n)}catch(r){ve(r)}},e.prototype.error=function(n){var t=this.partialObserver;if(t.error)try{t.error(n)}catch(r){ve(r)}else ve(n)},e.prototype.complete=function(){var n=this.partialObserver;if(n.complete)try{n.complete()}catch(t){ve(t)}},e})(),lt=(function(e){ie(n,e);function n(t,r,s){var a=e.call(this)||this,o;return G(t)||!t?o={next:t??void 0,error:r??void 0,complete:s??void 0}:o=t,a.destination=new os(o),a}return n})(Tt);function ve(e){Pn(e)}function is(e){throw e}var ls={closed:!0,next:Ct,error:is,complete:Ct},_t=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function It(e){return e}function Ot(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Dn(e)}function Dn(e){return e.length===0?It:e.length===1?e[0]:function(t){return e.reduce(function(r,s){return s(r)},t)}}var V=(function(){function e(n){n&&(this._subscribe=n)}return e.prototype.lift=function(n){var t=new e;return t.source=this,t.operator=n,t},e.prototype.subscribe=function(n,t,r){var s=this,a=cs(n)?n:new lt(n,t,r);return he(function(){var o=s,i=o.operator,l=o.source;a.add(i?i.call(a,l):l?s._subscribe(a):s._trySubscribe(a))}),a},e.prototype._trySubscribe=function(n){try{return this._subscribe(n)}catch(t){n.error(t)}},e.prototype.forEach=function(n,t){var r=this;return t=Rt(t),new t(function(s,a){var o=new lt({next:function(i){try{n(i)}catch(l){a(l),o.unsubscribe()}},error:a,complete:s});r.subscribe(o)})},e.prototype._subscribe=function(n){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(n)},e.prototype[_t]=function(){return this},e.prototype.pipe=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Dn(n)(this)},e.prototype.toPromise=function(n){var t=this;return n=Rt(n),new n(function(r,s){var a;t.subscribe(function(o){return a=o},function(o){return s(o)},function(){return r(a)})})},e.create=function(n){return new e(n)},e})();function Rt(e){var n;return(n=e??ss.Promise)!==null&&n!==void 0?n:Promise}function us(e){return e&&G(e.next)&&G(e.error)&&G(e.complete)}function cs(e){return e&&e instanceof Tt||us(e)&&Ln(e)}function Gn(e){return G(e[_t])}function Un(e){return Symbol.asyncIterator&&G(e?.[Symbol.asyncIterator])}function Hn(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function ds(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Fn=ds();function Bn(e){return G(e?.[Fn])}function Xn(e){return hr(this,arguments,function(){var t,r,s,a;return In(this,function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Ye(t.read())];case 3:return r=o.sent(),s=r.value,a=r.done,a?[4,Ye(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Ye(s)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Vn(e){return G(e?.getReader)}function ee(e){if(e instanceof V)return e;if(e!=null){if(Gn(e))return fs(e);if(xn(e))return vs(e);if(kn(e))return hs(e);if(Un(e))return Kn(e);if(Bn(e))return ps(e);if(Vn(e))return Es(e)}throw Hn(e)}function fs(e){return new V(function(n){var t=e[_t]();if(G(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function vs(e){return new V(function(n){for(var t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}function hs(e){return new V(function(n){e.then(function(t){n.closed||(n.next(t),n.complete())},function(t){return n.error(t)}).then(null,Pn)})}function ps(e){return new V(function(n){var t,r;try{for(var s=He(e),a=s.next();!a.done;a=s.next()){var o=a.value;if(n.next(o),n.closed)return}}catch(i){t={error:i}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}n.complete()})}function Kn(e){return new V(function(n){ms(e,n).catch(function(t){return n.error(t)})})}function Es(e){return Kn(Xn(e))}function ms(e,n){var t,r,s,a;return pr(this,void 0,void 0,function(){var o,i;return In(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),t=Er(e),l.label=1;case 1:return[4,t.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(o=r.value,n.next(o),n.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return i=l.sent(),s={error:i},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(a=t.return)?[4,a.call(t)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return n.complete(),[2]}})})}function Y(e,n,t,r,s){return new gs(e,n,t,r,s)}var gs=(function(e){ie(n,e);function n(t,r,s,a,o,i){var l=e.call(this,t)||this;return l.onFinalize=o,l.shouldUnsubscribe=i,l._next=r?function(u){try{r(u)}catch(_){t.error(_)}}:e.prototype._next,l._error=a?function(u){try{a(u)}catch(_){t.error(_)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=s?function(){try{s()}catch(u){t.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,l}return n.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},n})(Tt),$n={now:function(){return($n.delegate||Date).now()},delegate:void 0};function Ss(e){return e&&G(e.schedule)}function Ts(e){return e[e.length-1]}function _s(e){return Ss(Ts(e))?e.pop():void 0}function ne(e,n,t,r,s){r===void 0&&(r=0),s===void 0&&(s=!1);var a=n.schedule(function(){t(),s?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(a),!s)return a}function ut(e){return W(function(n,t){var r=null,s=!1,a;r=n.subscribe(Y(t,void 0,void 0,function(o){a=ee(e(o,ut(e)(n))),r?(r.unsubscribe(),r=null,a.subscribe(t)):s=!0})),s&&(r.unsubscribe(),r=null,a.subscribe(t))})}function Jn(e,n){return n===void 0&&(n=0),W(function(t,r){t.subscribe(Y(r,function(s){return ne(r,e,function(){return r.next(s)},n)},function(){return ne(r,e,function(){return r.complete()},n)},function(s){return ne(r,e,function(){return r.error(s)},n)}))})}function zn(e,n){return n===void 0&&(n=0),W(function(t,r){r.add(e.schedule(function(){return t.subscribe(r)},n))})}function Is(e,n){return ee(e).pipe(zn(n),Jn(n))}function bs(e,n){return ee(e).pipe(zn(n),Jn(n))}function ws(e,n){return new V(function(t){var r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}function As(e,n){return new V(function(t){var r;return ne(t,n,function(){r=e[Fn](),ne(t,n,function(){var s,a,o;try{s=r.next(),a=s.value,o=s.done}catch(i){t.error(i);return}o?t.complete():t.next(a)},0,!0)}),function(){return G(r?.return)&&r.return()}})}function Yn(e,n){if(!e)throw new Error("Iterable cannot be null");return new V(function(t){ne(t,n,function(){var r=e[Symbol.asyncIterator]();ne(t,n,function(){r.next().then(function(s){s.done?t.complete():t.next(s.value)})},0,!0)})})}function ys(e,n){return Yn(Xn(e),n)}function Ns(e,n){if(e!=null){if(Gn(e))return Is(e,n);if(xn(e))return ws(e,n);if(kn(e))return bs(e,n);if(Un(e))return Yn(e,n);if(Bn(e))return As(e,n);if(Vn(e))return ys(e,n)}throw Hn(e)}function Fe(e,n){return n?Ns(e,n):ee(e)}function ct(e,n){return W(function(t,r){var s=0;t.subscribe(Y(r,function(a){r.next(e.call(n,a,s++))}))})}function Cs(e,n,t,r,s,a,o,i){var l=[],u=0,_=0,w=!1,I=function(){w&&!l.length&&!u&&n.complete()},g=function(f){return u<r?v(f):l.push(f)},v=function(f){u++;var h=!1;ee(t(f,_++)).subscribe(Y(n,function(p){n.next(p)},function(){h=!0},void 0,function(){if(h)try{u--;for(var p=function(){var m=l.shift();o||v(m)};l.length&&u<r;)p();I()}catch(m){n.error(m)}}))};return e.subscribe(Y(n,g,function(){w=!0,I()})),function(){}}function Q(e,n,t){return t===void 0&&(t=1/0),G(n)?Q(function(r,s){return ct(function(a,o){return n(r,a,s,o)})(ee(e(r,s)))},t):(typeof n=="number"&&(t=n),W(function(r,s){return Cs(r,s,e,t)}))}function Os(e){return e===void 0&&(e=1/0),Q(It,e)}function Wn(e,n){return G(n)?Q(e,n,1):Q(e,1)}var Rs=St(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),de=(function(e){ie(n,e);function n(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return n.prototype.lift=function(t){var r=new xt(this,this);return r.operator=t,r},n.prototype._throwIfClosed=function(){if(this.closed)throw new Rs},n.prototype.next=function(t){var r=this;he(function(){var s,a;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=He(r.currentObservers),i=o.next();!i.done;i=o.next()){var l=i.value;l.next(t)}}catch(u){s={error:u}}finally{try{i&&!i.done&&(a=o.return)&&a.call(o)}finally{if(s)throw s.error}}}})},n.prototype.error=function(t){var r=this;he(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var s=r.observers;s.length;)s.shift().error(t)}})},n.prototype.complete=function(){var t=this;he(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},n.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(n.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),n.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},n.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},n.prototype._innerSubscribe=function(t){var r=this,s=this,a=s.hasError,o=s.isStopped,i=s.observers;return a||o?Mn:(this.currentObservers=null,i.push(t),new Je(function(){r.currentObservers=null,it(i,t)}))},n.prototype._checkFinalizedStatuses=function(t){var r=this,s=r.hasError,a=r.thrownError,o=r.isStopped;s?t.error(a):o&&t.complete()},n.prototype.asObservable=function(){var t=new V;return t.source=this,t},n.create=function(t,r){return new xt(t,r)},n})(V),xt=(function(e){ie(n,e);function n(t,r){var s=e.call(this)||this;return s.destination=t,s.source=r,s}return n.prototype.next=function(t){var r,s;(s=(r=this.destination)===null||r===void 0?void 0:r.next)===null||s===void 0||s.call(r,t)},n.prototype.error=function(t){var r,s;(s=(r=this.destination)===null||r===void 0?void 0:r.error)===null||s===void 0||s.call(r,t)},n.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},n.prototype._subscribe=function(t){var r,s;return(s=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&s!==void 0?s:Mn},n})(de);function xs(e){return W(function(n,t){var r=!1;n.subscribe(Y(t,function(s){r=!0,t.next(s)},function(){r||t.next(e),t.complete()}))})}var qn=new V(function(e){return e.complete()});function H(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=_s(e);return Fe(e,t)}function M(e,n){var t=G(e)?e:function(){return e},r=function(s){return s.error(t())};return new V(r)}var ks=St(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function dt(e){return W(function(n,t){try{n.subscribe(t)}finally{t.add(e)}})}var Zn=(function(e){ie(n,e);function n(t,r,s){t===void 0&&(t=1/0),r===void 0&&(r=1/0),s===void 0&&(s=$n);var a=e.call(this)||this;return a._bufferSize=t,a._windowTime=r,a._timestampProvider=s,a._buffer=[],a._infiniteTimeWindow=!0,a._infiniteTimeWindow=r===1/0,a._bufferSize=Math.max(1,t),a._windowTime=Math.max(1,r),a}return n.prototype.next=function(t){var r=this,s=r.isStopped,a=r._buffer,o=r._infiniteTimeWindow,i=r._timestampProvider,l=r._windowTime;s||(a.push(t),!o&&a.push(i.now()+l)),this._trimBuffer(),e.prototype.next.call(this,t)},n.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),s=this,a=s._infiniteTimeWindow,o=s._buffer,i=o.slice(),l=0;l<i.length&&!t.closed;l+=a?1:2)t.next(i[l]);return this._checkFinalizedStatuses(t),r},n.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,s=t._timestampProvider,a=t._buffer,o=t._infiniteTimeWindow,i=(o?1:2)*r;if(r<1/0&&i<a.length&&a.splice(0,a.length-i),!o){for(var l=s.now(),u=0,_=1;_<a.length&&a[_]<=l;_+=2)u=_;u&&a.splice(0,u+1)}},n})(de);function Ms(e,n){return W(function(t,r){var s=null,a=0,o=!1,i=function(){return o&&!s&&r.complete()};t.subscribe(Y(r,function(l){s?.unsubscribe();var u=0,_=a++;ee(e(l,_)).subscribe(s=Y(r,function(w){return r.next(n?n(l,w,_,u++):w)},function(){s=null,i()}))},function(){o=!0,i()}))})}function Ls(e,n,t){var r=G(e)||n||t?{next:e,error:n,complete:t}:e;return r?W(function(s,a){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var i=!0;s.subscribe(Y(a,function(l){var u;(u=r.next)===null||u===void 0||u.call(r,l),a.next(l)},function(){var l;i=!1,(l=r.complete)===null||l===void 0||l.call(r),a.complete()},function(l){var u;i=!1,(u=r.error)===null||u===void 0||u.call(r,l),a.error(l)},function(){var l,u;i&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(u=r.finalize)===null||u===void 0||u.call(r)}))}):It}function kt(e,n){return new Promise(function(t,r){var s=!1,a;e.subscribe({next:function(o){a=o,s=!0},error:r,complete:function(){s?t(a):r(new ks)}})})}function Ps(e){return new V(function(n){ee(e()).subscribe(n)})}const F=[];for(let e=0;e<256;++e)F.push((e+256).toString(16).slice(1));function Ds(e,n=0){return(F[e[n+0]]+F[e[n+1]]+F[e[n+2]]+F[e[n+3]]+"-"+F[e[n+4]]+F[e[n+5]]+"-"+F[e[n+6]]+F[e[n+7]]+"-"+F[e[n+8]]+F[e[n+9]]+"-"+F[e[n+10]]+F[e[n+11]]+F[e[n+12]]+F[e[n+13]]+F[e[n+14]]+F[e[n+15]]).toLowerCase()}let qe;const Gs=new Uint8Array(16);function Us(){if(!qe){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");qe=crypto.getRandomValues.bind(crypto)}return qe(Gs)}const Hs=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Mt={randomUUID:Hs};function se(e,n,t){if(Mt.randomUUID&&!e)return Mt.randomUUID();e=e||{};const r=e.random??e.rng?.()??Us();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Ds(r)}var Fs=(function(){var e=function(n,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},e(n,t)};return function(n,t){e(n,t);function r(){this.constructor=n}n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),Bs=Object.prototype.hasOwnProperty;function ft(e,n){return Bs.call(e,n)}function vt(e){if(Array.isArray(e)){for(var n=new Array(e.length),t=0;t<n.length;t++)n[t]=""+t;return n}if(Object.keys)return Object.keys(e);var r=[];for(var s in e)ft(e,s)&&r.push(s);return r}function K(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ht(e){for(var n=0,t=e.length,r;n<t;){if(r=e.charCodeAt(n),r>=48&&r<=57){n++;continue}return!1}return!0}function te(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Qn(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function pt(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var n=0,t=e.length;n<t;n++)if(pt(e[n]))return!0}else if(typeof e=="object"){for(var r=vt(e),s=r.length,a=0;a<s;a++)if(pt(e[r[a]]))return!0}}return!1}function Lt(e,n){var t=[e];for(var r in n){var s=typeof n[r]=="object"?JSON.stringify(n[r],null,2):n[r];typeof s<"u"&&t.push(r+": "+s)}return t.join(`
`)}var jn=(function(e){Fs(n,e);function n(t,r,s,a,o){var i=this.constructor,l=e.call(this,Lt(t,{name:r,index:s,operation:a,tree:o}))||this;return l.name=r,l.index=s,l.operation=a,l.tree=o,Object.setPrototypeOf(l,i.prototype),l.message=Lt(t,{name:r,index:s,operation:a,tree:o}),l}return n})(Error),D=jn,Xs=K,ae={add:function(e,n,t){return e[n]=this.value,{newDocument:t}},remove:function(e,n,t){var r=e[n];return delete e[n],{newDocument:t,removed:r}},replace:function(e,n,t){var r=e[n];return e[n]=this.value,{newDocument:t,removed:r}},move:function(e,n,t){var r=Be(t,this.path);r&&(r=K(r));var s=re(t,{op:"remove",path:this.from}).removed;return re(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:r}},copy:function(e,n,t){var r=Be(t,this.from);return re(t,{op:"add",path:this.path,value:K(r)}),{newDocument:t}},test:function(e,n,t){return{newDocument:t,test:ce(e[n],this.value)}},_get:function(e,n,t){return this.value=e[n],{newDocument:t}}},Vs={add:function(e,n,t){return ht(n)?e.splice(n,0,this.value):e[n]=this.value,{newDocument:t,index:n}},remove:function(e,n,t){var r=e.splice(n,1);return{newDocument:t,removed:r[0]}},replace:function(e,n,t){var r=e[n];return e[n]=this.value,{newDocument:t,removed:r}},move:ae.move,copy:ae.copy,test:ae.test,_get:ae._get};function Be(e,n){if(n=="")return e;var t={op:"_get",path:n};return re(e,t),t.value}function re(e,n,t,r,s,a){if(t===void 0&&(t=!1),r===void 0&&(r=!0),s===void 0&&(s=!0),a===void 0&&(a=0),t&&(typeof t=="function"?t(n,0,e,n.path):Xe(n,0)),n.path===""){var o={newDocument:e};if(n.op==="add")return o.newDocument=n.value,o;if(n.op==="replace")return o.newDocument=n.value,o.removed=e,o;if(n.op==="move"||n.op==="copy")return o.newDocument=Be(e,n.from),n.op==="move"&&(o.removed=e),o;if(n.op==="test"){if(o.test=ce(e,n.value),o.test===!1)throw new D("Test operation failed","TEST_OPERATION_FAILED",a,n,e);return o.newDocument=e,o}else{if(n.op==="remove")return o.removed=e,o.newDocument=null,o;if(n.op==="_get")return n.value=e,o;if(t)throw new D("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,n,e);return o}}else{r||(e=K(e));var i=n.path||"",l=i.split("/"),u=e,_=1,w=l.length,I=void 0,g=void 0,v=void 0;for(typeof t=="function"?v=t:v=Xe;;){if(g=l[_],g&&g.indexOf("~")!=-1&&(g=Qn(g)),s&&(g=="__proto__"||g=="prototype"&&_>0&&l[_-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&I===void 0&&(u[g]===void 0?I=l.slice(0,_).join("/"):_==w-1&&(I=n.path),I!==void 0&&v(n,0,e,I)),_++,Array.isArray(u)){if(g==="-")g=u.length;else{if(t&&!ht(g))throw new D("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,n,e);ht(g)&&(g=~~g)}if(_>=w){if(t&&n.op==="add"&&g>u.length)throw new D("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,n,e);var o=Vs[n.op].call(n,u,g,e);if(o.test===!1)throw new D("Test operation failed","TEST_OPERATION_FAILED",a,n,e);return o}}else if(_>=w){var o=ae[n.op].call(n,u,g,e);if(o.test===!1)throw new D("Test operation failed","TEST_OPERATION_FAILED",a,n,e);return o}if(u=u[g],t&&_<w&&(!u||typeof u!="object"))throw new D("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,n,e)}}}function oe(e,n,t,r,s){if(r===void 0&&(r=!0),s===void 0&&(s=!0),t&&!Array.isArray(n))throw new D("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=K(e));for(var a=new Array(n.length),o=0,i=n.length;o<i;o++)a[o]=re(e,n[o],t,!0,s,o),e=a[o].newDocument;return a.newDocument=e,a}function Ks(e,n,t){var r=re(e,n);if(r.test===!1)throw new D("Test operation failed","TEST_OPERATION_FAILED",t,n,e);return r.newDocument}function Xe(e,n,t,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new D("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,e,t);if(ae[e.op]){if(typeof e.path!="string")throw new D("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,e,t);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new D('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",n,e,t);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new D("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,e,t);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new D("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,e,t);if((e.op==="add"||e.op==="replace"||e.op==="test")&&pt(e.value))throw new D("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,e,t);if(t){if(e.op=="add"){var s=e.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new D("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,e,t)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new D("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,e,t)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},i=er([o],t);if(i&&i.name==="OPERATION_PATH_UNRESOLVABLE")throw new D("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,e,t)}}}else throw new D("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,e,t)}function er(e,n,t){try{if(!Array.isArray(e))throw new D("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(n)oe(K(n),K(e),t||!0);else{t=t||Xe;for(var r=0;r<e.length;r++)t(e[r],r,n,void 0)}}catch(s){if(s instanceof D)return s;throw s}}function ce(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){var t=Array.isArray(e),r=Array.isArray(n),s,a,o;if(t&&r){if(a=e.length,a!=n.length)return!1;for(s=a;s--!==0;)if(!ce(e[s],n[s]))return!1;return!0}if(t!=r)return!1;var i=Object.keys(e);if(a=i.length,a!==Object.keys(n).length)return!1;for(s=a;s--!==0;)if(!n.hasOwnProperty(i[s]))return!1;for(s=a;s--!==0;)if(o=i[s],!ce(e[o],n[o]))return!1;return!0}return e!==e&&n!==n}const $s=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:D,_areEquals:ce,applyOperation:re,applyPatch:oe,applyReducer:Ks,deepClone:Xs,getValueByPointer:Be,validate:er,validator:Xe},Symbol.toStringTag,{value:"Module"}));var bt=new WeakMap,Js=(function(){function e(n){this.observers=new Map,this.obj=n}return e})(),zs=(function(){function e(n,t){this.callback=n,this.observer=t}return e})();function Ys(e){return bt.get(e)}function Ws(e,n){return e.observers.get(n)}function qs(e,n){e.observers.delete(n.callback)}function Zs(e,n){n.unobserve()}function Qs(e,n){var t=[],r,s=Ys(e);if(!s)s=new Js(e),bt.set(e,s);else{var a=Ws(s,n);r=a&&a.observer}if(r)return r;if(r={},s.value=K(e),n){r.callback=n,r.next=null;var o=function(){Et(r)},i=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",i),window.addEventListener("keyup",i),window.addEventListener("mousedown",i),window.addEventListener("keydown",i),window.addEventListener("change",i))}return r.patches=t,r.object=e,r.unobserve=function(){Et(r),clearTimeout(r.next),qs(s,r),typeof window<"u"&&(window.removeEventListener("mouseup",i),window.removeEventListener("keyup",i),window.removeEventListener("mousedown",i),window.removeEventListener("keydown",i),window.removeEventListener("change",i))},s.observers.set(n,new zs(n,r)),r}function Et(e,n){n===void 0&&(n=!1);var t=bt.get(e.object);wt(t.value,e.object,e.patches,"",n),e.patches.length&&oe(t.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function wt(e,n,t,r,s){if(n!==e){typeof n.toJSON=="function"&&(n=n.toJSON());for(var a=vt(n),o=vt(e),i=!1,l=o.length-1;l>=0;l--){var u=o[l],_=e[u];if(ft(n,u)&&!(n[u]===void 0&&_!==void 0&&Array.isArray(n)===!1)){var w=n[u];typeof _=="object"&&_!=null&&typeof w=="object"&&w!=null&&Array.isArray(_)===Array.isArray(w)?wt(_,w,t,r+"/"+te(u),s):_!==w&&(s&&t.push({op:"test",path:r+"/"+te(u),value:K(_)}),t.push({op:"replace",path:r+"/"+te(u),value:K(w)}))}else Array.isArray(e)===Array.isArray(n)?(s&&t.push({op:"test",path:r+"/"+te(u),value:K(_)}),t.push({op:"remove",path:r+"/"+te(u)}),i=!0):(s&&t.push({op:"test",path:r,value:e}),t.push({op:"replace",path:r,value:n}))}if(!(!i&&a.length==o.length))for(var l=0;l<a.length;l++){var u=a[l];!ft(e,u)&&n[u]!==void 0&&t.push({op:"add",path:r+"/"+te(u),value:K(n[u])})}}}function js(e,n,t){t===void 0&&(t=!1);var r=[];return wt(e,n,r,"",t),r}const ea=Object.freeze(Object.defineProperty({__proto__:null,compare:js,generate:Et,observe:Qs,unobserve:Zs},Symbol.toStringTag,{value:"Module"}));Object.assign({},$s,ea,{JsonPatchError:jn,deepClone:K,escapePathComponent:te,unescapePathComponent:Qn});function ta(){let e=0,n=0;for(let r=0;r<28;r+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<r,(s&128)==0)return this.assertBounds(),[e,n]}let t=this.buf[this.pos++];if(e|=(t&15)<<28,n=(t&112)>>4,(t&128)==0)return this.assertBounds(),[e,n];for(let r=3;r<=31;r+=7){let s=this.buf[this.pos++];if(n|=(s&127)<<r,(s&128)==0)return this.assertBounds(),[e,n]}throw new Error("invalid varint")}function Ze(e,n,t){for(let a=0;a<28;a=a+7){const o=e>>>a,i=!(!(o>>>7)&&n==0),l=(i?o|128:o)&255;if(t.push(l),!i)return}const r=e>>>28&15|(n&7)<<4,s=n>>3!=0;if(t.push((s?r|128:r)&255),!!s){for(let a=3;a<31;a=a+7){const o=n>>>a,i=!!(o>>>7),l=(i?o|128:o)&255;if(t.push(l),!i)return}t.push(n>>>31&1)}}const pe=4294967296;function Pt(e){const n=e[0]==="-";n&&(e=e.slice(1));const t=1e6;let r=0,s=0;function a(o,i){const l=Number(e.slice(o,i));s*=t,r=r*t+l,r>=pe&&(s=s+(r/pe|0),r=r%pe)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),n?nr(r,s):At(r,s)}function na(e,n){let t=At(e,n);const r=t.hi&2147483648;r&&(t=nr(t.lo,t.hi));const s=tr(t.lo,t.hi);return r?"-"+s:s}function tr(e,n){if({lo:e,hi:n}=ra(e,n),n<=2097151)return String(pe*n+e);const t=e&16777215,r=(e>>>24|n<<8)&16777215,s=n>>16&65535;let a=t+r*6777216+s*6710656,o=r+s*8147497,i=s*2;const l=1e7;return a>=l&&(o+=Math.floor(a/l),a%=l),o>=l&&(i+=Math.floor(o/l),o%=l),i.toString()+Dt(o)+Dt(a)}function ra(e,n){return{lo:e>>>0,hi:n>>>0}}function At(e,n){return{lo:e|0,hi:n|0}}function nr(e,n){return n=~n,e?e=~e+1:n+=1,At(e,n)}const Dt=e=>{const n=String(e);return"0000000".slice(n.length)+n};function Gt(e,n){if(e>=0){for(;e>127;)n.push(e&127|128),e=e>>>7;n.push(e)}else{for(let t=0;t<9;t++)n.push(e&127|128),e=e>>7;n.push(1)}}function sa(){let e=this.buf[this.pos++],n=e&127;if((e&128)==0)return this.assertBounds(),n;if(e=this.buf[this.pos++],n|=(e&127)<<7,(e&128)==0)return this.assertBounds(),n;if(e=this.buf[this.pos++],n|=(e&127)<<14,(e&128)==0)return this.assertBounds(),n;if(e=this.buf[this.pos++],n|=(e&127)<<21,(e&128)==0)return this.assertBounds(),n;e=this.buf[this.pos++],n|=(e&15)<<28;for(let t=5;(e&128)!==0&&t<10;t++)e=this.buf[this.pos++];if((e&128)!=0)throw new Error("invalid varint");return this.assertBounds(),n>>>0}var Ut={};const z=aa();function aa(){const e=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof e.getBigInt64=="function"&&typeof e.getBigUint64=="function"&&typeof e.setBigInt64=="function"&&typeof e.setBigUint64=="function"&&(!!globalThis.Deno||typeof process!="object"||typeof Ut!="object"||Ut.BUF_BIGINT_DISABLE!=="1")){const t=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),s=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(o){const i=typeof o=="bigint"?o:BigInt(o);if(i>r||i<t)throw new Error(`invalid int64: ${o}`);return i},uParse(o){const i=typeof o=="bigint"?o:BigInt(o);if(i>a||i<s)throw new Error(`invalid uint64: ${o}`);return i},enc(o){return e.setBigInt64(0,this.parse(o),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(o){return e.setBigInt64(0,this.uParse(o),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec(o,i){return e.setInt32(0,o,!0),e.setInt32(4,i,!0),e.getBigInt64(0,!0)},uDec(o,i){return e.setInt32(0,o,!0),e.setInt32(4,i,!0),e.getBigUint64(0,!0)}}}return{zero:"0",supported:!1,parse(t){return typeof t!="string"&&(t=t.toString()),Ht(t),t},uParse(t){return typeof t!="string"&&(t=t.toString()),Ft(t),t},enc(t){return typeof t!="string"&&(t=t.toString()),Ht(t),Pt(t)},uEnc(t){return typeof t!="string"&&(t=t.toString()),Ft(t),Pt(t)},dec(t,r){return na(t,r)},uDec(t,r){return tr(t,r)}}}function Ht(e){if(!/^-?[0-9]+$/.test(e))throw new Error("invalid int64: "+e)}function Ft(e){if(!/^[0-9]+$/.test(e))throw new Error("invalid uint64: "+e)}const Qe=Symbol.for("@bufbuild/protobuf/text-encoding");function rr(){if(globalThis[Qe]==null){const e=new globalThis.TextEncoder,n=new globalThis.TextDecoder;globalThis[Qe]={encodeUtf8(t){return e.encode(t)},decodeUtf8(t){return n.decode(t)},checkUtf8(t){try{return encodeURIComponent(t),!0}catch{return!1}}}}return globalThis[Qe]}var q;(function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"})(q||(q={}));const oa=34028234663852886e22,ia=-34028234663852886e22,la=4294967295,ua=2147483647,ca=-2147483648;class O{constructor(n=rr().encodeUtf8){this.encodeUtf8=n,this.stack=[],this.chunks=[],this.buf=[]}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let n=0;for(let s=0;s<this.chunks.length;s++)n+=this.chunks[s].length;let t=new Uint8Array(n),r=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],r),r+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let n=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(n.byteLength),this.raw(n)}tag(n,t){return this.uint32((n<<3|t)>>>0)}raw(n){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(n),this}uint32(n){for(Bt(n);n>127;)this.buf.push(n&127|128),n=n>>>7;return this.buf.push(n),this}int32(n){return je(n),Gt(n,this.buf),this}bool(n){return this.buf.push(n?1:0),this}bytes(n){return this.uint32(n.byteLength),this.raw(n)}string(n){let t=this.encodeUtf8(n);return this.uint32(t.byteLength),this.raw(t)}float(n){da(n);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,n,!0),this.raw(t)}double(n){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,n,!0),this.raw(t)}fixed32(n){Bt(n);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,n,!0),this.raw(t)}sfixed32(n){je(n);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,n,!0),this.raw(t)}sint32(n){return je(n),n=(n<<1^n>>31)>>>0,Gt(n,this.buf),this}sfixed64(n){let t=new Uint8Array(8),r=new DataView(t.buffer),s=z.enc(n);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}fixed64(n){let t=new Uint8Array(8),r=new DataView(t.buffer),s=z.uEnc(n);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}int64(n){let t=z.enc(n);return Ze(t.lo,t.hi,this.buf),this}sint64(n){const t=z.enc(n),r=t.hi>>31,s=t.lo<<1^r,a=(t.hi<<1|t.lo>>>31)^r;return Ze(s,a,this.buf),this}uint64(n){const t=z.uEnc(n);return Ze(t.lo,t.hi,this.buf),this}}class T{constructor(n,t=rr().decodeUtf8){this.decodeUtf8=t,this.varint64=ta,this.uint32=sa,this.buf=n,this.len=n.length,this.pos=0,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength)}tag(){let n=this.uint32(),t=n>>>3,r=n&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(n,t){let r=this.pos;switch(n){case q.Varint:for(;this.buf[this.pos++]&128;);break;case q.Bit64:this.pos+=4;case q.Bit32:this.pos+=4;break;case q.LengthDelimited:let s=this.uint32();this.pos+=s;break;case q.StartGroup:for(;;){const[a,o]=this.tag();if(o===q.EndGroup){if(t!==void 0&&a!==t)throw new Error("invalid end group tag");break}this.skip(o,a)}break;default:throw new Error("cant skip wire type "+n)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let n=this.uint32();return n>>>1^-(n&1)}int64(){return z.dec(...this.varint64())}uint64(){return z.uDec(...this.varint64())}sint64(){let[n,t]=this.varint64(),r=-(n&1);return n=(n>>>1|(t&1)<<31)^r,t=t>>>1^r,z.dec(n,t)}bool(){let[n,t]=this.varint64();return n!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return z.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return z.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let n=this.uint32(),t=this.pos;return this.pos+=n,this.assertBounds(),this.buf.subarray(t,t+n)}string(){return this.decodeUtf8(this.bytes())}}function je(e){if(typeof e=="string")e=Number(e);else if(typeof e!="number")throw new Error("invalid int32: "+typeof e);if(!Number.isInteger(e)||e>ua||e<ca)throw new Error("invalid int32: "+e)}function Bt(e){if(typeof e=="string")e=Number(e);else if(typeof e!="number")throw new Error("invalid uint32: "+typeof e);if(!Number.isInteger(e)||e>la||e<0)throw new Error("invalid uint32: "+e)}function da(e){if(typeof e=="string"){const n=e;if(e=Number(e),Number.isNaN(e)&&n!=="NaN")throw new Error("invalid float32: "+n)}else if(typeof e!="number")throw new Error("invalid float32: "+typeof e);if(Number.isFinite(e)&&(e>oa||e<ia))throw new Error("invalid float32: "+e)}function et(){return{fields:{}}}var le={encode(e,n=new O){return Object.entries(e.fields).forEach(([t,r])=>{r!==void 0&&mt.encode({key:t,value:r},n.uint32(10).fork()).join()}),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=et();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;const o=mt.decode(t,t.uint32());o.value!==void 0&&(s.fields[o.key]=o.value);continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return le.fromPartial(e??{})},fromPartial(e){var n;const t=et();return t.fields=Object.entries((n=e.fields)!=null?n:{}).reduce((r,[s,a])=>(a!==void 0&&(r[s]=a),r),{}),t},wrap(e){const n=et();if(e!==void 0)for(const t of Object.keys(e))n.fields[t]=e[t];return n},unwrap(e){const n={};if(e.fields)for(const t of Object.keys(e.fields))n[t]=e.fields[t];return n}};function Xt(){return{key:"",value:void 0}}var mt={encode(e,n=new O){return e.key!==""&&n.uint32(10).string(e.key),e.value!==void 0&&y.encode(y.wrap(e.value),n.uint32(18).fork()).join(),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=Xt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.key=t.string();continue}case 2:{if(a!==18)break;s.value=y.unwrap(y.decode(t,t.uint32()));continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return mt.fromPartial(e??{})},fromPartial(e){var n,t;const r=Xt();return r.key=(n=e.key)!=null?n:"",r.value=(t=e.value)!=null?t:void 0,r}};function tt(){return{nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0}}var y={encode(e,n=new O){return e.nullValue!==void 0&&n.uint32(8).int32(e.nullValue),e.numberValue!==void 0&&n.uint32(17).double(e.numberValue),e.stringValue!==void 0&&n.uint32(26).string(e.stringValue),e.boolValue!==void 0&&n.uint32(32).bool(e.boolValue),e.structValue!==void 0&&le.encode(le.wrap(e.structValue),n.uint32(42).fork()).join(),e.listValue!==void 0&&ue.encode(ue.wrap(e.listValue),n.uint32(50).fork()).join(),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=tt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==8)break;s.nullValue=t.int32();continue}case 2:{if(a!==17)break;s.numberValue=t.double();continue}case 3:{if(a!==26)break;s.stringValue=t.string();continue}case 4:{if(a!==32)break;s.boolValue=t.bool();continue}case 5:{if(a!==42)break;s.structValue=le.unwrap(le.decode(t,t.uint32()));continue}case 6:{if(a!==50)break;s.listValue=ue.unwrap(ue.decode(t,t.uint32()));continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return y.fromPartial(e??{})},fromPartial(e){var n,t,r,s,a,o;const i=tt();return i.nullValue=(n=e.nullValue)!=null?n:void 0,i.numberValue=(t=e.numberValue)!=null?t:void 0,i.stringValue=(r=e.stringValue)!=null?r:void 0,i.boolValue=(s=e.boolValue)!=null?s:void 0,i.structValue=(a=e.structValue)!=null?a:void 0,i.listValue=(o=e.listValue)!=null?o:void 0,i},wrap(e){const n=tt();if(e===null)n.nullValue=0;else if(typeof e=="boolean")n.boolValue=e;else if(typeof e=="number")n.numberValue=e;else if(typeof e=="string")n.stringValue=e;else if(globalThis.Array.isArray(e))n.listValue=e;else if(typeof e=="object")n.structValue=e;else if(typeof e<"u")throw new globalThis.Error("Unsupported any value type: "+typeof e);return n},unwrap(e){if(e.stringValue!==void 0)return e.stringValue;if(e?.numberValue!==void 0)return e.numberValue;if(e?.boolValue!==void 0)return e.boolValue;if(e?.structValue!==void 0)return e.structValue;if(e?.listValue!==void 0)return e.listValue;if(e?.nullValue!==void 0)return null}};function nt(){return{values:[]}}var ue={encode(e,n=new O){for(const t of e.values)y.encode(y.wrap(t),n.uint32(10).fork()).join();return n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=nt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.values.push(y.unwrap(y.decode(t,t.uint32())));continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return ue.fromPartial(e??{})},fromPartial(e){var n;const t=nt();return t.values=((n=e.values)==null?void 0:n.map(r=>r))||[],t},wrap(e){const n=nt();return n.values=e??[],n},unwrap(e){return e?.hasOwnProperty("values")&&globalThis.Array.isArray(e.values)?e.values:e}},sr=(e=>(e[e.ADD=0]="ADD",e[e.REMOVE=1]="REMOVE",e[e.REPLACE=2]="REPLACE",e[e.MOVE=3]="MOVE",e[e.COPY=4]="COPY",e[e.TEST=5]="TEST",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(sr||{});function Vt(){return{op:0,path:"",from:void 0,value:void 0}}var Ee={encode(e,n=new O){return e.op!==0&&n.uint32(8).int32(e.op),e.path!==""&&n.uint32(18).string(e.path),e.from!==void 0&&n.uint32(26).string(e.from),e.value!==void 0&&y.encode(y.wrap(e.value),n.uint32(34).fork()).join(),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=Vt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==8)break;s.op=t.int32();continue}case 2:{if(a!==18)break;s.path=t.string();continue}case 3:{if(a!==26)break;s.from=t.string();continue}case 4:{if(a!==34)break;s.value=y.unwrap(y.decode(t,t.uint32()));continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Ee.fromPartial(e??{})},fromPartial(e){var n,t,r,s;const a=Vt();return a.op=(n=e.op)!=null?n:0,a.path=(t=e.path)!=null?t:"",a.from=(r=e.from)!=null?r:void 0,a.value=(s=e.value)!=null?s:void 0,a}};function Kt(){return{id:"",type:"",function:void 0}}var me={encode(e,n=new O){return e.id!==""&&n.uint32(10).string(e.id),e.type!==""&&n.uint32(18).string(e.type),e.function!==void 0&&ge.encode(e.function,n.uint32(26).fork()).join(),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=Kt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.id=t.string();continue}case 2:{if(a!==18)break;s.type=t.string();continue}case 3:{if(a!==26)break;s.function=ge.decode(t,t.uint32());continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return me.fromPartial(e??{})},fromPartial(e){var n,t;const r=Kt();return r.id=(n=e.id)!=null?n:"",r.type=(t=e.type)!=null?t:"",r.function=e.function!==void 0&&e.function!==null?ge.fromPartial(e.function):void 0,r}};function $t(){return{name:"",arguments:""}}var ge={encode(e,n=new O){return e.name!==""&&n.uint32(10).string(e.name),e.arguments!==""&&n.uint32(18).string(e.arguments),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=$t();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.name=t.string();continue}case 2:{if(a!==18)break;s.arguments=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return ge.fromPartial(e??{})},fromPartial(e){var n,t;const r=$t();return r.name=(n=e.name)!=null?n:"",r.arguments=(t=e.arguments)!=null?t:"",r}};function Jt(){return{id:"",role:"",content:void 0,name:void 0,toolCalls:[],toolCallId:void 0,error:void 0}}var Se={encode(e,n=new O){e.id!==""&&n.uint32(10).string(e.id),e.role!==""&&n.uint32(18).string(e.role),e.content!==void 0&&n.uint32(26).string(e.content),e.name!==void 0&&n.uint32(34).string(e.name);for(const t of e.toolCalls)me.encode(t,n.uint32(42).fork()).join();return e.toolCallId!==void 0&&n.uint32(50).string(e.toolCallId),e.error!==void 0&&n.uint32(58).string(e.error),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=Jt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.id=t.string();continue}case 2:{if(a!==18)break;s.role=t.string();continue}case 3:{if(a!==26)break;s.content=t.string();continue}case 4:{if(a!==34)break;s.name=t.string();continue}case 5:{if(a!==42)break;s.toolCalls.push(me.decode(t,t.uint32()));continue}case 6:{if(a!==50)break;s.toolCallId=t.string();continue}case 7:{if(a!==58)break;s.error=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Se.fromPartial(e??{})},fromPartial(e){var n,t,r,s,a,o,i;const l=Jt();return l.id=(n=e.id)!=null?n:"",l.role=(t=e.role)!=null?t:"",l.content=(r=e.content)!=null?r:void 0,l.name=(s=e.name)!=null?s:void 0,l.toolCalls=((a=e.toolCalls)==null?void 0:a.map(u=>me.fromPartial(u)))||[],l.toolCallId=(o=e.toolCallId)!=null?o:void 0,l.error=(i=e.error)!=null?i:void 0,l}},ar=(e=>(e[e.TEXT_MESSAGE_START=0]="TEXT_MESSAGE_START",e[e.TEXT_MESSAGE_CONTENT=1]="TEXT_MESSAGE_CONTENT",e[e.TEXT_MESSAGE_END=2]="TEXT_MESSAGE_END",e[e.TOOL_CALL_START=3]="TOOL_CALL_START",e[e.TOOL_CALL_ARGS=4]="TOOL_CALL_ARGS",e[e.TOOL_CALL_END=5]="TOOL_CALL_END",e[e.STATE_SNAPSHOT=6]="STATE_SNAPSHOT",e[e.STATE_DELTA=7]="STATE_DELTA",e[e.MESSAGES_SNAPSHOT=8]="MESSAGES_SNAPSHOT",e[e.RAW=9]="RAW",e[e.CUSTOM=10]="CUSTOM",e[e.RUN_STARTED=11]="RUN_STARTED",e[e.RUN_FINISHED=12]="RUN_FINISHED",e[e.RUN_ERROR=13]="RUN_ERROR",e[e.STEP_STARTED=14]="STEP_STARTED",e[e.STEP_FINISHED=15]="STEP_FINISHED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(ar||{});function zt(){return{type:0,timestamp:void 0,rawEvent:void 0}}var b={encode(e,n=new O){return e.type!==0&&n.uint32(8).int32(e.type),e.timestamp!==void 0&&n.uint32(16).int64(e.timestamp),e.rawEvent!==void 0&&y.encode(y.wrap(e.rawEvent),n.uint32(26).fork()).join(),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=zt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==8)break;s.type=t.int32();continue}case 2:{if(a!==16)break;s.timestamp=fa(t.int64());continue}case 3:{if(a!==26)break;s.rawEvent=y.unwrap(y.decode(t,t.uint32()));continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return b.fromPartial(e??{})},fromPartial(e){var n,t,r;const s=zt();return s.type=(n=e.type)!=null?n:0,s.timestamp=(t=e.timestamp)!=null?t:void 0,s.rawEvent=(r=e.rawEvent)!=null?r:void 0,s}};function Yt(){return{baseEvent:void 0,messageId:"",role:void 0}}var Te={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.messageId!==""&&n.uint32(18).string(e.messageId),e.role!==void 0&&n.uint32(26).string(e.role),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=Yt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.messageId=t.string();continue}case 3:{if(a!==26)break;s.role=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Te.fromPartial(e??{})},fromPartial(e){var n,t;const r=Yt();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,r.messageId=(n=e.messageId)!=null?n:"",r.role=(t=e.role)!=null?t:void 0,r}};function Wt(){return{baseEvent:void 0,messageId:"",delta:""}}var _e={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.messageId!==""&&n.uint32(18).string(e.messageId),e.delta!==""&&n.uint32(26).string(e.delta),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=Wt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.messageId=t.string();continue}case 3:{if(a!==26)break;s.delta=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return _e.fromPartial(e??{})},fromPartial(e){var n,t;const r=Wt();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,r.messageId=(n=e.messageId)!=null?n:"",r.delta=(t=e.delta)!=null?t:"",r}};function qt(){return{baseEvent:void 0,messageId:""}}var Ie={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.messageId!==""&&n.uint32(18).string(e.messageId),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=qt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.messageId=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Ie.fromPartial(e??{})},fromPartial(e){var n;const t=qt();return t.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,t.messageId=(n=e.messageId)!=null?n:"",t}};function Zt(){return{baseEvent:void 0,toolCallId:"",toolCallName:"",parentMessageId:void 0}}var be={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.toolCallId!==""&&n.uint32(18).string(e.toolCallId),e.toolCallName!==""&&n.uint32(26).string(e.toolCallName),e.parentMessageId!==void 0&&n.uint32(34).string(e.parentMessageId),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=Zt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.toolCallId=t.string();continue}case 3:{if(a!==26)break;s.toolCallName=t.string();continue}case 4:{if(a!==34)break;s.parentMessageId=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return be.fromPartial(e??{})},fromPartial(e){var n,t,r;const s=Zt();return s.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,s.toolCallId=(n=e.toolCallId)!=null?n:"",s.toolCallName=(t=e.toolCallName)!=null?t:"",s.parentMessageId=(r=e.parentMessageId)!=null?r:void 0,s}};function Qt(){return{baseEvent:void 0,toolCallId:"",delta:""}}var we={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.toolCallId!==""&&n.uint32(18).string(e.toolCallId),e.delta!==""&&n.uint32(26).string(e.delta),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=Qt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.toolCallId=t.string();continue}case 3:{if(a!==26)break;s.delta=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return we.fromPartial(e??{})},fromPartial(e){var n,t;const r=Qt();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,r.toolCallId=(n=e.toolCallId)!=null?n:"",r.delta=(t=e.delta)!=null?t:"",r}};function jt(){return{baseEvent:void 0,toolCallId:""}}var Ae={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.toolCallId!==""&&n.uint32(18).string(e.toolCallId),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=jt();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.toolCallId=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Ae.fromPartial(e??{})},fromPartial(e){var n;const t=jt();return t.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,t.toolCallId=(n=e.toolCallId)!=null?n:"",t}};function en(){return{baseEvent:void 0,snapshot:void 0}}var ye={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.snapshot!==void 0&&y.encode(y.wrap(e.snapshot),n.uint32(18).fork()).join(),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=en();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.snapshot=y.unwrap(y.decode(t,t.uint32()));continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return ye.fromPartial(e??{})},fromPartial(e){var n;const t=en();return t.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,t.snapshot=(n=e.snapshot)!=null?n:void 0,t}};function tn(){return{baseEvent:void 0,delta:[]}}var Ne={encode(e,n=new O){e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join();for(const t of e.delta)Ee.encode(t,n.uint32(18).fork()).join();return n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=tn();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.delta.push(Ee.decode(t,t.uint32()));continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Ne.fromPartial(e??{})},fromPartial(e){var n;const t=tn();return t.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,t.delta=((n=e.delta)==null?void 0:n.map(r=>Ee.fromPartial(r)))||[],t}};function nn(){return{baseEvent:void 0,messages:[]}}var Ce={encode(e,n=new O){e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join();for(const t of e.messages)Se.encode(t,n.uint32(18).fork()).join();return n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=nn();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.messages.push(Se.decode(t,t.uint32()));continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Ce.fromPartial(e??{})},fromPartial(e){var n;const t=nn();return t.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,t.messages=((n=e.messages)==null?void 0:n.map(r=>Se.fromPartial(r)))||[],t}};function rn(){return{baseEvent:void 0,event:void 0,source:void 0}}var Oe={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.event!==void 0&&y.encode(y.wrap(e.event),n.uint32(18).fork()).join(),e.source!==void 0&&n.uint32(26).string(e.source),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=rn();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.event=y.unwrap(y.decode(t,t.uint32()));continue}case 3:{if(a!==26)break;s.source=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Oe.fromPartial(e??{})},fromPartial(e){var n,t;const r=rn();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,r.event=(n=e.event)!=null?n:void 0,r.source=(t=e.source)!=null?t:void 0,r}};function sn(){return{baseEvent:void 0,name:"",value:void 0}}var Re={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.name!==""&&n.uint32(18).string(e.name),e.value!==void 0&&y.encode(y.wrap(e.value),n.uint32(26).fork()).join(),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=sn();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.name=t.string();continue}case 3:{if(a!==26)break;s.value=y.unwrap(y.decode(t,t.uint32()));continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Re.fromPartial(e??{})},fromPartial(e){var n,t;const r=sn();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,r.name=(n=e.name)!=null?n:"",r.value=(t=e.value)!=null?t:void 0,r}};function an(){return{baseEvent:void 0,threadId:"",runId:""}}var xe={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.threadId!==""&&n.uint32(18).string(e.threadId),e.runId!==""&&n.uint32(26).string(e.runId),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=an();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.threadId=t.string();continue}case 3:{if(a!==26)break;s.runId=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return xe.fromPartial(e??{})},fromPartial(e){var n,t;const r=an();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,r.threadId=(n=e.threadId)!=null?n:"",r.runId=(t=e.runId)!=null?t:"",r}};function on(){return{baseEvent:void 0,threadId:"",runId:"",result:void 0}}var ke={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.threadId!==""&&n.uint32(18).string(e.threadId),e.runId!==""&&n.uint32(26).string(e.runId),e.result!==void 0&&y.encode(y.wrap(e.result),n.uint32(34).fork()).join(),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=on();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.threadId=t.string();continue}case 3:{if(a!==26)break;s.runId=t.string();continue}case 4:{if(a!==34)break;s.result=y.unwrap(y.decode(t,t.uint32()));continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return ke.fromPartial(e??{})},fromPartial(e){var n,t,r;const s=on();return s.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,s.threadId=(n=e.threadId)!=null?n:"",s.runId=(t=e.runId)!=null?t:"",s.result=(r=e.result)!=null?r:void 0,s}};function ln(){return{baseEvent:void 0,code:void 0,message:""}}var Me={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.code!==void 0&&n.uint32(18).string(e.code),e.message!==""&&n.uint32(26).string(e.message),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=ln();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.code=t.string();continue}case 3:{if(a!==26)break;s.message=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Me.fromPartial(e??{})},fromPartial(e){var n,t;const r=ln();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,r.code=(n=e.code)!=null?n:void 0,r.message=(t=e.message)!=null?t:"",r}};function un(){return{baseEvent:void 0,stepName:""}}var Le={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.stepName!==""&&n.uint32(18).string(e.stepName),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=un();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.stepName=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Le.fromPartial(e??{})},fromPartial(e){var n;const t=un();return t.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,t.stepName=(n=e.stepName)!=null?n:"",t}};function cn(){return{baseEvent:void 0,stepName:""}}var Pe={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.stepName!==""&&n.uint32(18).string(e.stepName),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=cn();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.stepName=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Pe.fromPartial(e??{})},fromPartial(e){var n;const t=cn();return t.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,t.stepName=(n=e.stepName)!=null?n:"",t}};function dn(){return{baseEvent:void 0,messageId:void 0,role:void 0,delta:void 0}}var De={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.messageId!==void 0&&n.uint32(18).string(e.messageId),e.role!==void 0&&n.uint32(26).string(e.role),e.delta!==void 0&&n.uint32(34).string(e.delta),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=dn();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.messageId=t.string();continue}case 3:{if(a!==26)break;s.role=t.string();continue}case 4:{if(a!==34)break;s.delta=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return De.fromPartial(e??{})},fromPartial(e){var n,t,r;const s=dn();return s.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,s.messageId=(n=e.messageId)!=null?n:void 0,s.role=(t=e.role)!=null?t:void 0,s.delta=(r=e.delta)!=null?r:void 0,s}};function fn(){return{baseEvent:void 0,toolCallId:void 0,toolCallName:void 0,parentMessageId:void 0,delta:void 0}}var Ge={encode(e,n=new O){return e.baseEvent!==void 0&&b.encode(e.baseEvent,n.uint32(10).fork()).join(),e.toolCallId!==void 0&&n.uint32(18).string(e.toolCallId),e.toolCallName!==void 0&&n.uint32(26).string(e.toolCallName),e.parentMessageId!==void 0&&n.uint32(34).string(e.parentMessageId),e.delta!==void 0&&n.uint32(42).string(e.delta),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=fn();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.baseEvent=b.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.toolCallId=t.string();continue}case 3:{if(a!==26)break;s.toolCallName=t.string();continue}case 4:{if(a!==34)break;s.parentMessageId=t.string();continue}case 5:{if(a!==42)break;s.delta=t.string();continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return Ge.fromPartial(e??{})},fromPartial(e){var n,t,r,s;const a=fn();return a.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?b.fromPartial(e.baseEvent):void 0,a.toolCallId=(n=e.toolCallId)!=null?n:void 0,a.toolCallName=(t=e.toolCallName)!=null?t:void 0,a.parentMessageId=(r=e.parentMessageId)!=null?r:void 0,a.delta=(s=e.delta)!=null?s:void 0,a}};function vn(){return{textMessageStart:void 0,textMessageContent:void 0,textMessageEnd:void 0,toolCallStart:void 0,toolCallArgs:void 0,toolCallEnd:void 0,stateSnapshot:void 0,stateDelta:void 0,messagesSnapshot:void 0,raw:void 0,custom:void 0,runStarted:void 0,runFinished:void 0,runError:void 0,stepStarted:void 0,stepFinished:void 0,textMessageChunk:void 0,toolCallChunk:void 0}}var or={encode(e,n=new O){return e.textMessageStart!==void 0&&Te.encode(e.textMessageStart,n.uint32(10).fork()).join(),e.textMessageContent!==void 0&&_e.encode(e.textMessageContent,n.uint32(18).fork()).join(),e.textMessageEnd!==void 0&&Ie.encode(e.textMessageEnd,n.uint32(26).fork()).join(),e.toolCallStart!==void 0&&be.encode(e.toolCallStart,n.uint32(34).fork()).join(),e.toolCallArgs!==void 0&&we.encode(e.toolCallArgs,n.uint32(42).fork()).join(),e.toolCallEnd!==void 0&&Ae.encode(e.toolCallEnd,n.uint32(50).fork()).join(),e.stateSnapshot!==void 0&&ye.encode(e.stateSnapshot,n.uint32(58).fork()).join(),e.stateDelta!==void 0&&Ne.encode(e.stateDelta,n.uint32(66).fork()).join(),e.messagesSnapshot!==void 0&&Ce.encode(e.messagesSnapshot,n.uint32(74).fork()).join(),e.raw!==void 0&&Oe.encode(e.raw,n.uint32(82).fork()).join(),e.custom!==void 0&&Re.encode(e.custom,n.uint32(90).fork()).join(),e.runStarted!==void 0&&xe.encode(e.runStarted,n.uint32(98).fork()).join(),e.runFinished!==void 0&&ke.encode(e.runFinished,n.uint32(106).fork()).join(),e.runError!==void 0&&Me.encode(e.runError,n.uint32(114).fork()).join(),e.stepStarted!==void 0&&Le.encode(e.stepStarted,n.uint32(122).fork()).join(),e.stepFinished!==void 0&&Pe.encode(e.stepFinished,n.uint32(130).fork()).join(),e.textMessageChunk!==void 0&&De.encode(e.textMessageChunk,n.uint32(138).fork()).join(),e.toolCallChunk!==void 0&&Ge.encode(e.toolCallChunk,n.uint32(146).fork()).join(),n},decode(e,n){const t=e instanceof T?e:new T(e),r=n===void 0?t.len:t.pos+n,s=vn();for(;t.pos<r;){const a=t.uint32();switch(a>>>3){case 1:{if(a!==10)break;s.textMessageStart=Te.decode(t,t.uint32());continue}case 2:{if(a!==18)break;s.textMessageContent=_e.decode(t,t.uint32());continue}case 3:{if(a!==26)break;s.textMessageEnd=Ie.decode(t,t.uint32());continue}case 4:{if(a!==34)break;s.toolCallStart=be.decode(t,t.uint32());continue}case 5:{if(a!==42)break;s.toolCallArgs=we.decode(t,t.uint32());continue}case 6:{if(a!==50)break;s.toolCallEnd=Ae.decode(t,t.uint32());continue}case 7:{if(a!==58)break;s.stateSnapshot=ye.decode(t,t.uint32());continue}case 8:{if(a!==66)break;s.stateDelta=Ne.decode(t,t.uint32());continue}case 9:{if(a!==74)break;s.messagesSnapshot=Ce.decode(t,t.uint32());continue}case 10:{if(a!==82)break;s.raw=Oe.decode(t,t.uint32());continue}case 11:{if(a!==90)break;s.custom=Re.decode(t,t.uint32());continue}case 12:{if(a!==98)break;s.runStarted=xe.decode(t,t.uint32());continue}case 13:{if(a!==106)break;s.runFinished=ke.decode(t,t.uint32());continue}case 14:{if(a!==114)break;s.runError=Me.decode(t,t.uint32());continue}case 15:{if(a!==122)break;s.stepStarted=Le.decode(t,t.uint32());continue}case 16:{if(a!==130)break;s.stepFinished=Pe.decode(t,t.uint32());continue}case 17:{if(a!==138)break;s.textMessageChunk=De.decode(t,t.uint32());continue}case 18:{if(a!==146)break;s.toolCallChunk=Ge.decode(t,t.uint32());continue}}if((a&7)===4||a===0)break;t.skip(a&7)}return s},create(e){return or.fromPartial(e??{})},fromPartial(e){const n=vn();return n.textMessageStart=e.textMessageStart!==void 0&&e.textMessageStart!==null?Te.fromPartial(e.textMessageStart):void 0,n.textMessageContent=e.textMessageContent!==void 0&&e.textMessageContent!==null?_e.fromPartial(e.textMessageContent):void 0,n.textMessageEnd=e.textMessageEnd!==void 0&&e.textMessageEnd!==null?Ie.fromPartial(e.textMessageEnd):void 0,n.toolCallStart=e.toolCallStart!==void 0&&e.toolCallStart!==null?be.fromPartial(e.toolCallStart):void 0,n.toolCallArgs=e.toolCallArgs!==void 0&&e.toolCallArgs!==null?we.fromPartial(e.toolCallArgs):void 0,n.toolCallEnd=e.toolCallEnd!==void 0&&e.toolCallEnd!==null?Ae.fromPartial(e.toolCallEnd):void 0,n.stateSnapshot=e.stateSnapshot!==void 0&&e.stateSnapshot!==null?ye.fromPartial(e.stateSnapshot):void 0,n.stateDelta=e.stateDelta!==void 0&&e.stateDelta!==null?Ne.fromPartial(e.stateDelta):void 0,n.messagesSnapshot=e.messagesSnapshot!==void 0&&e.messagesSnapshot!==null?Ce.fromPartial(e.messagesSnapshot):void 0,n.raw=e.raw!==void 0&&e.raw!==null?Oe.fromPartial(e.raw):void 0,n.custom=e.custom!==void 0&&e.custom!==null?Re.fromPartial(e.custom):void 0,n.runStarted=e.runStarted!==void 0&&e.runStarted!==null?xe.fromPartial(e.runStarted):void 0,n.runFinished=e.runFinished!==void 0&&e.runFinished!==null?ke.fromPartial(e.runFinished):void 0,n.runError=e.runError!==void 0&&e.runError!==null?Me.fromPartial(e.runError):void 0,n.stepStarted=e.stepStarted!==void 0&&e.stepStarted!==null?Le.fromPartial(e.stepStarted):void 0,n.stepFinished=e.stepFinished!==void 0&&e.stepFinished!==null?Pe.fromPartial(e.stepFinished):void 0,n.textMessageChunk=e.textMessageChunk!==void 0&&e.textMessageChunk!==null?De.fromPartial(e.textMessageChunk):void 0,n.toolCallChunk=e.toolCallChunk!==void 0&&e.toolCallChunk!==null?Ge.fromPartial(e.toolCallChunk):void 0,n}};function fa(e){const n=globalThis.Number(e.toString());if(n>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(n<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return n}function va(e){var n;const t=or.decode(e),r=Object.values(t).find(s=>s!==void 0);if(!r)throw new Error("Invalid event");if(r.type=ar[r.baseEvent.type],r.timestamp=r.baseEvent.timestamp,r.rawEvent=r.baseEvent.rawEvent,r.type===c.MESSAGES_SNAPSHOT)for(const s of r.messages){const a=s;((n=a.toolCalls)==null?void 0:n.length)===0&&(a.toolCalls=void 0)}if(r.type===c.STATE_DELTA)for(const s of r.delta)s.op=sr[s.op].toLowerCase(),Object.keys(s).forEach(a=>{s[a]===void 0&&delete s[a]});return Object.keys(r).forEach(s=>{r[s]===void 0&&delete r[s]}),Rn.parse(r)}var ha="application/vnd.ag-ui.event+proto";const pa=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,hn=e=>{if(typeof e!="string")throw new TypeError("Invalid argument expected string");const n=e.match(pa);if(!n)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return n.shift(),n},pn=e=>e==="*"||e==="x"||e==="X",En=e=>{const n=parseInt(e,10);return isNaN(n)?e:n},Ea=(e,n)=>typeof e!=typeof n?[String(e),String(n)]:[e,n],ma=(e,n)=>{if(pn(e)||pn(n))return 0;const[t,r]=Ea(En(e),En(n));return t>r?1:t<r?-1:0},mn=(e,n)=>{for(let t=0;t<Math.max(e.length,n.length);t++){const r=ma(e[t]||"0",n[t]||"0");if(r!==0)return r}return 0},ga=(e,n)=>{const t=hn(e),r=hn(n),s=t.pop(),a=r.pop(),o=mn(t,r);return o!==0?o:s&&a?mn(s.split("."),a.split(".")):s||a?s?-1:1:0};var Sa={},Ta=Object.defineProperty,_a=Object.defineProperties,Ia=Object.getOwnPropertyDescriptors,Ve=Object.getOwnPropertySymbols,ir=Object.prototype.hasOwnProperty,lr=Object.prototype.propertyIsEnumerable,gn=(e,n,t)=>n in e?Ta(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,B=(e,n)=>{for(var t in n||(n={}))ir.call(n,t)&&gn(e,t,n[t]);if(Ve)for(var t of Ve(n))lr.call(n,t)&&gn(e,t,n[t]);return e},j=(e,n)=>_a(e,Ia(n)),ba=(e,n)=>{var t={};for(var r in e)ir.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(e!=null&&Ve)for(var r of Ve(e))n.indexOf(r)<0&&lr.call(e,r)&&(t[r]=e[r]);return t},C=e=>{if(typeof structuredClone=="function")return structuredClone(e);try{return JSON.parse(JSON.stringify(e))}catch{return B({},e)}};function Qa(){return se()}async function L(e,n,t,r){let s=n,a=t,o;for(let i of e)try{let l=await r(i,C(s),C(a));if(l===void 0)continue;if(l.messages!==void 0&&(s=l.messages),l.state!==void 0&&(a=l.state),o=l.stopPropagation,o===!0)break}catch(l){Sa.JEST_WORKER_ID!==void 0||console.error("Subscriber error:",l);continue}return B(B(B({},JSON.stringify(s)!==JSON.stringify(n)?{messages:s}:{}),JSON.stringify(a)!==JSON.stringify(t)?{state:a}:{}),o!==void 0?{stopPropagation:o}:{})}var ur=(e,n,t,r)=>{let s=C(t.messages),a=C(e.state),o={},i=u=>{u.messages!==void 0&&(s=u.messages,o.messages=u.messages),u.state!==void 0&&(a=u.state,o.state=u.state)},l=()=>{let u=C(o);return o={},u.messages!==void 0||u.state!==void 0?H(u):qn};return n.pipe(Wn(async u=>{var _,w,I,g;let v=await L(r,s,a,(f,h,p)=>{var m;return(m=f.onEvent)==null?void 0:m.call(f,{event:u,agent:t,input:e,messages:h,state:p})});if(i(v),v.stopPropagation===!0)return l();switch(u.type){case c.TEXT_MESSAGE_START:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onTextMessageStartEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});if(i(f),f.stopPropagation!==!0){let{messageId:h,role:p="assistant"}=u,m={id:h,role:p,content:""};s.push(m),i({messages:s})}return l()}case c.TEXT_MESSAGE_CONTENT:{let{messageId:f,delta:h}=u,p=s.find(E=>E.id===f);if(!p)return console.warn(`TEXT_MESSAGE_CONTENT: No message found with ID '${f}'`),l();let m=await L(r,s,a,(E,A,N)=>{var U;return(U=E.onTextMessageContentEvent)==null?void 0:U.call(E,{event:u,messages:A,state:N,agent:t,input:e,textMessageBuffer:typeof p.content=="string"?p.content:""})});if(i(m),m.stopPropagation!==!0){let E=typeof p.content=="string"?p.content:"";p.content=`${E}${h}`,i({messages:s})}return l()}case c.TEXT_MESSAGE_END:{let{messageId:f}=u,h=s.find(m=>m.id===f);if(!h)return console.warn(`TEXT_MESSAGE_END: No message found with ID '${f}'`),l();let p=await L(r,s,a,(m,E,A)=>{var N;return(N=m.onTextMessageEndEvent)==null?void 0:N.call(m,{event:u,messages:E,state:A,agent:t,input:e,textMessageBuffer:typeof h.content=="string"?h.content:""})});return i(p),await Promise.all(r.map(m=>{var E;(E=m.onNewMessage)==null||E.call(m,{message:h,messages:s,state:a,agent:t,input:e})})),l()}case c.TOOL_CALL_START:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onToolCallStartEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});if(i(f),f.stopPropagation!==!0){let{toolCallId:h,toolCallName:p,parentMessageId:m}=u,E;m&&s.length>0&&s[s.length-1].id===m?E=s[s.length-1]:(E={id:m||h,role:"assistant",toolCalls:[]},s.push(E)),E.toolCalls!=null||(E.toolCalls=[]),E.toolCalls.push({id:h,type:"function",function:{name:p,arguments:""}}),i({messages:s})}return l()}case c.TOOL_CALL_ARGS:{let{toolCallId:f,delta:h}=u,p=s.find(A=>{var N;return(N=A.toolCalls)==null?void 0:N.some(U=>U.id===f)});if(!p)return console.warn(`TOOL_CALL_ARGS: No message found containing tool call with ID '${f}'`),l();let m=p.toolCalls.find(A=>A.id===f);if(!m)return console.warn(`TOOL_CALL_ARGS: No tool call found with ID '${f}'`),l();let E=await L(r,s,a,(A,N,U)=>{var $;let J=m.function.arguments,fe=m.function.name,ze={};try{ze=bn(J)}catch{}return($=A.onToolCallArgsEvent)==null?void 0:$.call(A,{event:u,messages:N,state:U,agent:t,input:e,toolCallBuffer:J,toolCallName:fe,partialToolCallArgs:ze})});return i(E),E.stopPropagation!==!0&&(m.function.arguments+=h,i({messages:s})),l()}case c.TOOL_CALL_END:{let{toolCallId:f}=u,h=s.find(E=>{var A;return(A=E.toolCalls)==null?void 0:A.some(N=>N.id===f)});if(!h)return console.warn(`TOOL_CALL_END: No message found containing tool call with ID '${f}'`),l();let p=h.toolCalls.find(E=>E.id===f);if(!p)return console.warn(`TOOL_CALL_END: No tool call found with ID '${f}'`),l();let m=await L(r,s,a,(E,A,N)=>{var U;let $=p.function.arguments,J=p.function.name,fe={};try{fe=JSON.parse($)}catch{}return(U=E.onToolCallEndEvent)==null?void 0:U.call(E,{event:u,messages:A,state:N,agent:t,input:e,toolCallName:J,toolCallArgs:fe})});return i(m),await Promise.all(r.map(E=>{var A;(A=E.onNewToolCall)==null||A.call(E,{toolCall:p,messages:s,state:a,agent:t,input:e})})),l()}case c.TOOL_CALL_RESULT:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onToolCallResultEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});if(i(f),f.stopPropagation!==!0){let{messageId:h,toolCallId:p,content:m,role:E}=u,A={id:h,toolCallId:p,role:E||"tool",content:m};s.push(A),await Promise.all(r.map(N=>{var U;(U=N.onNewMessage)==null||U.call(N,{message:A,messages:s,state:a,agent:t,input:e})})),i({messages:s})}return l()}case c.STATE_SNAPSHOT:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onStateSnapshotEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});if(i(f),f.stopPropagation!==!0){let{snapshot:h}=u;a=h,i({state:a})}return l()}case c.STATE_DELTA:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onStateDeltaEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});if(i(f),f.stopPropagation!==!0){let{delta:h}=u;try{a=oe(a,h,!0,!1).newDocument,i({state:a})}catch(p){let m=p instanceof Error?p.message:String(p);console.warn(`Failed to apply state patch:
Current state: ${JSON.stringify(a,null,2)}
Patch operations: ${JSON.stringify(h,null,2)}
Error: ${m}`)}}return l()}case c.MESSAGES_SNAPSHOT:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onMessagesSnapshotEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});if(i(f),f.stopPropagation!==!0){let{messages:h}=u;s=h,i({messages:s})}return l()}case c.ACTIVITY_SNAPSHOT:{let f=u,h=s.findIndex(N=>N.id===f.messageId),p=h>=0?s[h]:void 0,m=p?.role==="activity"?p:void 0,E=(_=f.replace)!=null?_:!0,A=await L(r,s,a,(N,U,$)=>{var J;return(J=N.onActivitySnapshotEvent)==null?void 0:J.call(N,{event:f,messages:U,state:$,agent:t,input:e,activityMessage:m,existingMessage:p})});if(i(A),A.stopPropagation!==!0){let N={id:f.messageId,role:"activity",activityType:f.activityType,content:C(f.content)},U;h===-1?(s.push(N),U=N):m?E&&(s[h]=j(B({},m),{activityType:f.activityType,content:C(f.content)})):E&&(s[h]=N,U=N),i({messages:s}),U&&await Promise.all(r.map($=>{var J;return(J=$.onNewMessage)==null?void 0:J.call($,{message:U,messages:s,state:a,agent:t,input:e})}))}return l()}case c.ACTIVITY_DELTA:{let f=u,h=s.findIndex(A=>A.id===f.messageId);if(h===-1)return console.warn(`ACTIVITY_DELTA: No message found with ID '${f.messageId}' to apply patch`),l();let p=s[h];if(p.role!=="activity")return console.warn(`ACTIVITY_DELTA: Message '${f.messageId}' is not an activity message`),l();let m=p,E=await L(r,s,a,(A,N,U)=>{var $;return($=A.onActivityDeltaEvent)==null?void 0:$.call(A,{event:f,messages:N,state:U,agent:t,input:e,activityMessage:m})});if(i(E),E.stopPropagation!==!0)try{let A=C((w=m.content)!=null?w:{}),N=oe(A,(I=f.patch)!=null?I:[],!0,!1).newDocument;s[h]=j(B({},m),{content:C(N),activityType:f.activityType}),i({messages:s})}catch(A){let N=A instanceof Error?A.message:String(A);console.warn(`Failed to apply activity patch for '${f.messageId}': ${N}`)}return l()}case c.RAW:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onRawEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});return i(f),l()}case c.CUSTOM:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onCustomEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});return i(f),l()}case c.RUN_STARTED:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onRunStartedEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});if(i(f),f.stopPropagation!==!0){let h=u;if((g=h.input)!=null&&g.messages){for(let p of h.input.messages)s.find(m=>m.id===p.id)||s.push(p);i({messages:s})}}return l()}case c.RUN_FINISHED:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onRunFinishedEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e,result:u.result})});return i(f),l()}case c.RUN_ERROR:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onRunErrorEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});return i(f),l()}case c.STEP_STARTED:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onStepStartedEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});return i(f),l()}case c.STEP_FINISHED:{let f=await L(r,s,a,(h,p,m)=>{var E;return(E=h.onStepFinishedEvent)==null?void 0:E.call(h,{event:u,messages:p,state:m,agent:t,input:e})});return i(f),l()}case c.TEXT_MESSAGE_CHUNK:throw new Error("TEXT_MESSAGE_CHUNK must be tranformed before being applied");case c.TOOL_CALL_CHUNK:throw new Error("TOOL_CALL_CHUNK must be tranformed before being applied");case c.THINKING_START:return l();case c.THINKING_END:return l();case c.THINKING_TEXT_MESSAGE_START:return l();case c.THINKING_TEXT_MESSAGE_CONTENT:return l();case c.THINKING_TEXT_MESSAGE_END:return l()}return u.type,l()}),Os(),r.length>0?xs({}):u=>u)},rt=e=>n=>{let t=new Map,r=new Map,s=!1,a=!1,o=!1,i=new Map,l=!1,u=!1,_=!1,w=()=>{t.clear(),r.clear(),i.clear(),l=!1,u=!1,s=!1,a=!1,_=!0};return n.pipe(Q(I=>{let g=I.type;if(e&&console.debug("[VERIFY]:",JSON.stringify(I)),a)return M(()=>new P(`Cannot send event type '${g}': The run has already errored with 'RUN_ERROR'. No further events can be sent.`));if(s&&g!==c.RUN_ERROR&&g!==c.RUN_STARTED)return M(()=>new P(`Cannot send event type '${g}': The run has already finished with 'RUN_FINISHED'. Start a new run with 'RUN_STARTED'.`));if(o){if(g===c.RUN_STARTED){if(_&&!s)return M(()=>new P("Cannot send 'RUN_STARTED' while a run is still active. The previous run must be finished with 'RUN_FINISHED' before starting a new run."));s&&w()}}else if(o=!0,g!==c.RUN_STARTED&&g!==c.RUN_ERROR)return M(()=>new P("First event must be 'RUN_STARTED'"));switch(g){case c.TEXT_MESSAGE_START:{let v=I.messageId;return t.has(v)?M(()=>new P(`Cannot send 'TEXT_MESSAGE_START' event: A text message with ID '${v}' is already in progress. Complete it with 'TEXT_MESSAGE_END' first.`)):(t.set(v,!0),H(I))}case c.TEXT_MESSAGE_CONTENT:{let v=I.messageId;return t.has(v)?H(I):M(()=>new P(`Cannot send 'TEXT_MESSAGE_CONTENT' event: No active text message found with ID '${v}'. Start a text message with 'TEXT_MESSAGE_START' first.`))}case c.TEXT_MESSAGE_END:{let v=I.messageId;return t.has(v)?(t.delete(v),H(I)):M(()=>new P(`Cannot send 'TEXT_MESSAGE_END' event: No active text message found with ID '${v}'. A 'TEXT_MESSAGE_START' event must be sent first.`))}case c.TOOL_CALL_START:{let v=I.toolCallId;return r.has(v)?M(()=>new P(`Cannot send 'TOOL_CALL_START' event: A tool call with ID '${v}' is already in progress. Complete it with 'TOOL_CALL_END' first.`)):(r.set(v,!0),H(I))}case c.TOOL_CALL_ARGS:{let v=I.toolCallId;return r.has(v)?H(I):M(()=>new P(`Cannot send 'TOOL_CALL_ARGS' event: No active tool call found with ID '${v}'. Start a tool call with 'TOOL_CALL_START' first.`))}case c.TOOL_CALL_END:{let v=I.toolCallId;return r.has(v)?(r.delete(v),H(I)):M(()=>new P(`Cannot send 'TOOL_CALL_END' event: No active tool call found with ID '${v}'. A 'TOOL_CALL_START' event must be sent first.`))}case c.STEP_STARTED:{let v=I.stepName;return i.has(v)?M(()=>new P(`Step "${v}" is already active for 'STEP_STARTED'`)):(i.set(v,!0),H(I))}case c.STEP_FINISHED:{let v=I.stepName;return i.has(v)?(i.delete(v),H(I)):M(()=>new P(`Cannot send 'STEP_FINISHED' for step "${v}" that was not started`))}case c.RUN_STARTED:return _=!0,H(I);case c.RUN_FINISHED:{if(i.size>0){let v=Array.from(i.keys()).join(", ");return M(()=>new P(`Cannot send 'RUN_FINISHED' while steps are still active: ${v}`))}if(t.size>0){let v=Array.from(t.keys()).join(", ");return M(()=>new P(`Cannot send 'RUN_FINISHED' while text messages are still active: ${v}`))}if(r.size>0){let v=Array.from(r.keys()).join(", ");return M(()=>new P(`Cannot send 'RUN_FINISHED' while tool calls are still active: ${v}`))}return s=!0,H(I)}case c.RUN_ERROR:return a=!0,H(I);case c.CUSTOM:return H(I);case c.THINKING_TEXT_MESSAGE_START:return l?u?M(()=>new P("Cannot send 'THINKING_TEXT_MESSAGE_START' event: A thinking message is already in progress. Complete it with 'THINKING_TEXT_MESSAGE_END' first.")):(u=!0,H(I)):M(()=>new P("Cannot send 'THINKING_TEXT_MESSAGE_START' event: A thinking step is not in progress. Create one with 'THINKING_START' first."));case c.THINKING_TEXT_MESSAGE_CONTENT:return u?H(I):M(()=>new P("Cannot send 'THINKING_TEXT_MESSAGE_CONTENT' event: No active thinking message found. Start a message with 'THINKING_TEXT_MESSAGE_START' first."));case c.THINKING_TEXT_MESSAGE_END:return u?(u=!1,H(I)):M(()=>new P("Cannot send 'THINKING_TEXT_MESSAGE_END' event: No active thinking message found. A 'THINKING_TEXT_MESSAGE_START' event must be sent first."));case c.THINKING_START:return l?M(()=>new P("Cannot send 'THINKING_START' event: A thinking step is already in progress. End it with 'THINKING_END' first.")):(l=!0,H(I));case c.THINKING_END:return l?(l=!1,H(I)):M(()=>new P("Cannot send 'THINKING_END' event: No active thinking step found. A 'THINKING_START' event must be sent first."));default:return H(I)}}))},wa=(e,n)=>Ps(()=>Fe(fetch(e,n))).pipe(Ms(t=>{var r;if(!t.ok){let o=t.headers.get("content-type")||"";return Fe(t.text()).pipe(Q(i=>{let l=i;if(o.includes("application/json"))try{l=JSON.parse(i)}catch{}let u=new Error(`HTTP ${t.status}: ${typeof l=="string"?l:JSON.stringify(l)}`);return u.status=t.status,u.payload=l,M(()=>u)}))}let s={type:"headers",status:t.status,headers:t.headers},a=(r=t.body)==null?void 0:r.getReader();return a?new V(o=>(o.next(s),(async()=>{try{for(;;){let{done:i,value:l}=await a.read();if(i)break;let u={type:"data",data:l};o.next(u)}o.complete()}catch(i){o.error(i)}})(),()=>{a.cancel().catch(i=>{if(i?.name!=="AbortError")throw i})})):M(()=>new Error("Failed to getReader() from response"))})),Aa=e=>{let n=new de,t=new TextDecoder("utf-8",{fatal:!1}),r="";e.subscribe({next:a=>{if(a.type!=="headers"&&a.type==="data"&&a.data){let o=t.decode(a.data,{stream:!0});r+=o;let i=r.split(/\n\n/);r=i.pop()||"";for(let l of i)s(l)}},error:a=>n.error(a),complete:()=>{r&&(r+=t.decode(),s(r)),n.complete()}});function s(a){let o=a.split(`
`),i=[];for(let l of o)l.startsWith("data: ")&&i.push(l.slice(6));if(i.length>0)try{let l=i.join(`
`),u=JSON.parse(l);n.next(u)}catch(l){n.error(l)}}return n.asObservable()},ya=e=>{let n=new de,t=new Uint8Array(0);e.subscribe({next:s=>{if(s.type!=="headers"&&s.type==="data"&&s.data){let a=new Uint8Array(t.length+s.data.length);a.set(t,0),a.set(s.data,t.length),t=a,r()}},error:s=>n.error(s),complete:()=>{if(t.length>0)try{r()}catch{console.warn("Incomplete or invalid protocol buffer data at stream end")}n.complete()}});function r(){for(;t.length>=4;){let s=4+new DataView(t.buffer,t.byteOffset,4).getUint32(0,!1);if(t.length<s)break;try{let a=t.slice(4,s),o=va(a);n.next(o),t=t.slice(s)}catch(a){let o=a instanceof Error?a.message:String(a);n.error(new Error(`Failed to decode protocol buffer message: ${o}`));return}}}return n.asObservable()},Na=e=>{let n=new de,t=new Zn,r=!1;return e.subscribe({next:s=>{t.next(s),s.type==="headers"&&!r?(r=!0,s.headers.get("content-type")===ha?ya(t).subscribe({next:a=>n.next(a),error:a=>n.error(a),complete:()=>n.complete()}):Aa(t).subscribe({next:a=>{try{let o=Rn.parse(a);n.next(o)}catch(o){n.error(o)}},error:a=>{if(a?.name==="AbortError"){n.next({type:c.RUN_ERROR,rawEvent:a}),n.complete();return}return n.error(a)},complete:()=>n.complete()})):r||n.error(new Error("No headers event received before data events"))},error:s=>{t.error(s),n.error(s)},complete:()=>{t.complete()}}),n.asObservable()},R=wn(["TextMessageStart","TextMessageContent","TextMessageEnd","ActionExecutionStart","ActionExecutionArgs","ActionExecutionEnd","ActionExecutionResult","AgentStateMessage","MetaEvent","RunStarted","RunFinished","RunError","NodeStarted","NodeFinished"]),Ca=wn(["LangGraphInterruptEvent","PredictState","Exit"]),Oa=k({type:S(R.enum.TextMessageStart),messageId:d(),parentMessageId:d().optional(),role:d().optional()}),Ra=k({type:S(R.enum.TextMessageContent),messageId:d(),content:d()}),xa=k({type:S(R.enum.TextMessageEnd),messageId:d()}),ka=k({type:S(R.enum.ActionExecutionStart),actionExecutionId:d(),actionName:d(),parentMessageId:d().optional()}),Ma=k({type:S(R.enum.ActionExecutionArgs),actionExecutionId:d(),args:d()}),La=k({type:S(R.enum.ActionExecutionEnd),actionExecutionId:d()}),Pa=k({type:S(R.enum.ActionExecutionResult),actionName:d(),actionExecutionId:d(),result:d()}),Da=k({type:S(R.enum.AgentStateMessage),threadId:d(),agentName:d(),nodeName:d(),runId:d(),active:st(),role:d(),state:d(),running:st()}),Ga=k({type:S(R.enum.MetaEvent),name:Ca,value:X()}),Ua=k({type:S(R.enum.RunError),message:d(),code:d().optional()});Ke("type",[Oa,Ra,xa,ka,Ma,La,Pa,Da,Ga,Ua]);k({id:d(),role:d(),content:d(),parentMessageId:d().optional()});k({id:d(),name:d(),arguments:X(),parentMessageId:d().optional()});k({id:d(),result:X(),actionExecutionId:d(),actionName:d()});var Ha=e=>{if(typeof e=="string")return e;if(!Array.isArray(e))return;let n=e.filter(t=>t.type==="text").map(t=>t.text).filter(t=>t.length>0);if(n.length!==0)return n.join(`
`)},Fa=(e,n,t)=>r=>{let s={},a=!0,o=!0,i="",l=null,u=null,_=[],w={},I=g=>{typeof g=="object"&&g!==null&&("messages"in g&&delete g.messages,s=g)};return r.pipe(Q(g=>{switch(g.type){case c.TEXT_MESSAGE_START:{let v=g;return[{type:R.enum.TextMessageStart,messageId:v.messageId,role:v.role}]}case c.TEXT_MESSAGE_CONTENT:{let v=g;return[{type:R.enum.TextMessageContent,messageId:v.messageId,content:v.delta}]}case c.TEXT_MESSAGE_END:{let v=g;return[{type:R.enum.TextMessageEnd,messageId:v.messageId}]}case c.TOOL_CALL_START:{let v=g;return _.push({id:v.toolCallId,type:"function",function:{name:v.toolCallName,arguments:""}}),o=!0,w[v.toolCallId]=v.toolCallName,[{type:R.enum.ActionExecutionStart,actionExecutionId:v.toolCallId,actionName:v.toolCallName,parentMessageId:v.parentMessageId}]}case c.TOOL_CALL_ARGS:{let v=g,f=_.find(p=>p.id===v.toolCallId);if(!f)return console.warn(`TOOL_CALL_ARGS: No tool call found with ID '${v.toolCallId}'`),[];f.function.arguments+=v.delta;let h=!1;if(u){let p=u.find(m=>m.tool==f.function.name);if(p)try{let m=JSON.parse(bn(f.function.arguments));p.tool_argument&&p.tool_argument in m?(I(j(B({},s),{[p.state_key]:m[p.tool_argument]})),h=!0):p.tool_argument||(I(j(B({},s),{[p.state_key]:m})),h=!0)}catch{}}return[{type:R.enum.ActionExecutionArgs,actionExecutionId:v.toolCallId,args:v.delta},...h?[{type:R.enum.AgentStateMessage,threadId:e,agentName:t,nodeName:i,runId:n,running:a,role:"assistant",state:JSON.stringify(s),active:o}]:[]]}case c.TOOL_CALL_END:{let v=g;return[{type:R.enum.ActionExecutionEnd,actionExecutionId:v.toolCallId}]}case c.TOOL_CALL_RESULT:{let v=g;return[{type:R.enum.ActionExecutionResult,actionExecutionId:v.toolCallId,result:v.content,actionName:w[v.toolCallId]||"unknown"}]}case c.RAW:return[];case c.CUSTOM:{let v=g;switch(v.name){case"Exit":a=!1;break;case"PredictState":u=v.value;break}return[{type:R.enum.MetaEvent,name:v.name,value:v.value}]}case c.STATE_SNAPSHOT:return I(g.snapshot),[{type:R.enum.AgentStateMessage,threadId:e,agentName:t,nodeName:i,runId:n,running:a,role:"assistant",state:JSON.stringify(s),active:o}];case c.STATE_DELTA:{let v=oe(s,g.delta,!0,!1);return v?(I(v.newDocument),[{type:R.enum.AgentStateMessage,threadId:e,agentName:t,nodeName:i,runId:n,running:a,role:"assistant",state:JSON.stringify(s),active:o}]):[]}case c.MESSAGES_SNAPSHOT:return l=g.messages,[{type:R.enum.AgentStateMessage,threadId:e,agentName:t,nodeName:i,runId:n,running:a,role:"assistant",state:JSON.stringify(B(B({},s),l?{messages:l}:{})),active:!0}];case c.RUN_STARTED:return[];case c.RUN_FINISHED:return l&&(s.messages=l),Object.keys(s).length===0?[]:[{type:R.enum.AgentStateMessage,threadId:e,agentName:t,nodeName:i,runId:n,running:a,role:"assistant",state:JSON.stringify(B(B({},s),l?{messages:Ba(l)}:{})),active:!1}];case c.RUN_ERROR:{let v=g;return[{type:R.enum.RunError,message:v.message,code:v.code}]}case c.STEP_STARTED:return i=g.stepName,_=[],u=null,[{type:R.enum.AgentStateMessage,threadId:e,agentName:t,nodeName:i,runId:n,running:a,role:"assistant",state:JSON.stringify(s),active:!0}];case c.STEP_FINISHED:return _=[],u=null,[{type:R.enum.AgentStateMessage,threadId:e,agentName:t,nodeName:i,runId:n,running:a,role:"assistant",state:JSON.stringify(s),active:!1}];default:return[]}}))};function Ba(e){var n;let t=[];for(let r of e)if(r.role==="assistant"||r.role==="user"||r.role==="system"){let s=Ha(r.content);if(s){let a={id:r.id,role:r.role,content:s};t.push(a)}if(r.role==="assistant"&&r.toolCalls&&r.toolCalls.length>0)for(let a of r.toolCalls){let o={id:a.id,name:a.function.name,arguments:JSON.parse(a.function.arguments),parentMessageId:r.id};t.push(o)}}else if(r.role==="tool"){let s="unknown";for(let o of e)if(o.role==="assistant"&&(n=o.toolCalls)!=null&&n.length){for(let i of o.toolCalls)if(i.id===r.toolCallId){s=i.function.name;break}}let a={id:r.id,result:r.content,actionExecutionId:r.toolCallId,actionName:s};t.push(a)}return t}var Ue=e=>n=>{let t,r,s,a=()=>{if(!t||s!=="text")throw new Error("No text message to close");let l={type:c.TEXT_MESSAGE_END,messageId:t.messageId};return s=void 0,t=void 0,e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_END",JSON.stringify(l)),l},o=()=>{if(!r||s!=="tool")throw new Error("No tool call to close");let l={type:c.TOOL_CALL_END,toolCallId:r.toolCallId};return s=void 0,r=void 0,e&&console.debug("[TRANSFORM]: TOOL_CALL_END",JSON.stringify(l)),l},i=()=>s==="text"?[a()]:s==="tool"?[o()]:[];return n.pipe(Q(l=>{switch(l.type){case c.TEXT_MESSAGE_START:case c.TEXT_MESSAGE_CONTENT:case c.TEXT_MESSAGE_END:case c.TOOL_CALL_START:case c.TOOL_CALL_ARGS:case c.TOOL_CALL_END:case c.TOOL_CALL_RESULT:case c.STATE_SNAPSHOT:case c.STATE_DELTA:case c.MESSAGES_SNAPSHOT:case c.CUSTOM:case c.RUN_STARTED:case c.RUN_FINISHED:case c.RUN_ERROR:case c.STEP_STARTED:case c.STEP_FINISHED:case c.THINKING_START:case c.THINKING_END:case c.THINKING_TEXT_MESSAGE_START:case c.THINKING_TEXT_MESSAGE_CONTENT:case c.THINKING_TEXT_MESSAGE_END:return[...i(),l];case c.RAW:case c.ACTIVITY_SNAPSHOT:case c.ACTIVITY_DELTA:return[l];case c.TEXT_MESSAGE_CHUNK:let u=l,_=[];if((s!=="text"||u.messageId!==void 0&&u.messageId!==t?.messageId)&&_.push(...i()),s!=="text"){if(u.messageId===void 0)throw new Error("First TEXT_MESSAGE_CHUNK must have a messageId");t={messageId:u.messageId},s="text";let g={type:c.TEXT_MESSAGE_START,messageId:u.messageId,role:u.role||"assistant"};_.push(g),e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_START",JSON.stringify(g))}if(u.delta!==void 0){let g={type:c.TEXT_MESSAGE_CONTENT,messageId:t.messageId,delta:u.delta};_.push(g),e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_CONTENT",JSON.stringify(g))}return _;case c.TOOL_CALL_CHUNK:let w=l,I=[];if((s!=="tool"||w.toolCallId!==void 0&&w.toolCallId!==r?.toolCallId)&&I.push(...i()),s!=="tool"){if(w.toolCallId===void 0)throw new Error("First TOOL_CALL_CHUNK must have a toolCallId");if(w.toolCallName===void 0)throw new Error("First TOOL_CALL_CHUNK must have a toolCallName");r={toolCallId:w.toolCallId,toolCallName:w.toolCallName,parentMessageId:w.parentMessageId},s="tool";let g={type:c.TOOL_CALL_START,toolCallId:w.toolCallId,toolCallName:w.toolCallName,parentMessageId:w.parentMessageId};I.push(g),e&&console.debug("[TRANSFORM]: TOOL_CALL_START",JSON.stringify(g))}if(w.delta!==void 0){let g={type:c.TOOL_CALL_ARGS,toolCallId:r.toolCallId,delta:w.delta};I.push(g),e&&console.debug("[TRANSFORM]: TOOL_CALL_ARGS",JSON.stringify(g))}return I}return l.type,[]}),dt(()=>{i()}))},cr=class{runNext(e,n){return n.run(e).pipe(Ue(!1))}runNextWithState(e,n){let t=C(e.messages||[]),r=C(e.state||{}),s=new Zn;return ur(e,s,n,[]).subscribe(a=>{a.messages!==void 0&&(t=a.messages),a.state!==void 0&&(r=a.state)}),this.runNext(e,n).pipe(Wn(async a=>(s.next(a),await new Promise(o=>setTimeout(o,0)),{event:a,messages:C(t),state:C(r)})))}},Xa=class extends cr{constructor(e){super(),this.fn=e}run(e,n){return this.fn(e,n)}};function Va(e){let n=e.content;if(Array.isArray(n)){let t=n.filter(r=>typeof r=="object"&&r!==null&&"type"in r&&r.type==="text"&&typeof r.text=="string").map(r=>r.text).join("");return j(B({},e),{content:t})}return typeof n=="string"?e:j(B({},e),{content:""})}var Ka=class extends cr{run(e,n){let t=e,{parentRunId:r}=t,s=ba(t,["parentRunId"]),a=j(B({},s),{messages:s.messages.map(Va)});return this.runNext(a,n)}},$a={version:"0.0.41"},Ja=class{constructor({agentId:e,description:n,threadId:t,initialMessages:r,initialState:s,debug:a}={}){this.debug=!1,this.subscribers=[],this.isRunning=!1,this.middlewares=[],this.agentId=e,this.description=n??"",this.threadId=t??se(),this.messages=C(r??[]),this.state=C(s??{}),this.debug=a??!1,ga(this.maxVersion,"0.0.39")<=0&&this.middlewares.unshift(new Ka)}get maxVersion(){return $a.version}subscribe(e){return this.subscribers.push(e),{unsubscribe:()=>{this.subscribers=this.subscribers.filter(n=>n!==e)}}}use(...e){let n=e.map(t=>typeof t=="function"?new Xa(t):t);return this.middlewares.push(...n),this}async runAgent(e,n){var t;try{this.isRunning=!0,this.agentId=(t=this.agentId)!=null?t:se();let r=this.prepareRunAgentInput(e),s,a=new Set(this.messages.map(u=>u.id)),o=[{onRunFinishedEvent:u=>{s=u.result}},...this.subscribers,n??{}];await this.onInitialize(r,o);let i=Ot(()=>this.middlewares.length===0?this.run(r):this.middlewares.reduceRight((u,_)=>({run:w=>_.run(w,u)}),this).run(r),Ue(this.debug),rt(this.debug),u=>this.apply(r,u,o),u=>this.processApplyEvents(r,u,o),ut(u=>(this.isRunning=!1,this.onError(r,u,o))),dt(()=>{this.isRunning=!1,this.onFinalize(r,o)}));await kt(i(H(null)));let l=C(this.messages).filter(u=>!a.has(u.id));return{result:s,newMessages:l}}finally{this.isRunning=!1}}connect(e){throw new yt}async connectAgent(e,n){var t;try{this.isRunning=!0,this.agentId=(t=this.agentId)!=null?t:se();let r=this.prepareRunAgentInput(e),s,a=new Set(this.messages.map(u=>u.id)),o=[{onRunFinishedEvent:u=>{s=u.result}},...this.subscribers,n??{}];await this.onInitialize(r,o);let i=Ot(()=>this.connect(r),Ue(this.debug),rt(this.debug),u=>this.apply(r,u,o),u=>this.processApplyEvents(r,u,o),ut(u=>(this.isRunning=!1,u instanceof yt?qn:this.onError(r,u,o))),dt(()=>{this.isRunning=!1,this.onFinalize(r,o)}));await kt(i(H(null)));let l=C(this.messages).filter(u=>!a.has(u.id));return{result:s,newMessages:l}}finally{this.isRunning=!1}}abortRun(){}apply(e,n,t){return ur(e,n,this,t)}processApplyEvents(e,n,t){return n.pipe(Ls(r=>{r.messages&&(this.messages=r.messages,t.forEach(s=>{var a;(a=s.onMessagesChanged)==null||a.call(s,{messages:this.messages,state:this.state,agent:this,input:e})})),r.state&&(this.state=r.state,t.forEach(s=>{var a;(a=s.onStateChanged)==null||a.call(s,{state:this.state,messages:this.messages,agent:this,input:e})}))}))}prepareRunAgentInput(e){var n,t,r;let s=C(this.messages).filter(a=>a.role!=="activity");return{threadId:this.threadId,runId:e?.runId||se(),tools:C((n=e?.tools)!=null?n:[]),context:C((t=e?.context)!=null?t:[]),forwardedProps:C((r=e?.forwardedProps)!=null?r:{}),state:C(this.state),messages:s}}async onInitialize(e,n){let t=await L(n,this.messages,this.state,(r,s,a)=>{var o;return(o=r.onRunInitialized)==null?void 0:o.call(r,{messages:s,state:a,agent:this,input:e})});(t.messages!==void 0||t.state!==void 0)&&(t.messages&&(this.messages=t.messages,e.messages=t.messages,n.forEach(r=>{var s;(s=r.onMessagesChanged)==null||s.call(r,{messages:this.messages,state:this.state,agent:this,input:e})})),t.state&&(this.state=t.state,e.state=t.state,n.forEach(r=>{var s;(s=r.onStateChanged)==null||s.call(r,{state:this.state,messages:this.messages,agent:this,input:e})})))}onError(e,n,t){return Fe(L(t,this.messages,this.state,(r,s,a)=>{var o;return(o=r.onRunFailed)==null?void 0:o.call(r,{error:n,messages:s,state:a,agent:this,input:e})})).pipe(ct(r=>{let s=r;if((s.messages!==void 0||s.state!==void 0)&&(s.messages!==void 0&&(this.messages=s.messages,t.forEach(a=>{var o;(o=a.onMessagesChanged)==null||o.call(a,{messages:this.messages,state:this.state,agent:this,input:e})})),s.state!==void 0&&(this.state=s.state,t.forEach(a=>{var o;(o=a.onStateChanged)==null||o.call(a,{state:this.state,messages:this.messages,agent:this,input:e})}))),s.stopPropagation!==!0)throw console.error("Agent execution failed:",n),n;return{}}))}async onFinalize(e,n){let t=await L(n,this.messages,this.state,(r,s,a)=>{var o;return(o=r.onRunFinalized)==null?void 0:o.call(r,{messages:s,state:a,agent:this,input:e})});(t.messages!==void 0||t.state!==void 0)&&(t.messages!==void 0&&(this.messages=t.messages,n.forEach(r=>{var s;(s=r.onMessagesChanged)==null||s.call(r,{messages:this.messages,state:this.state,agent:this,input:e})})),t.state!==void 0&&(this.state=t.state,n.forEach(r=>{var s;(s=r.onStateChanged)==null||s.call(r,{state:this.state,messages:this.messages,agent:this,input:e})})))}clone(){let e=Object.create(Object.getPrototypeOf(this));return e.agentId=this.agentId,e.description=this.description,e.threadId=this.threadId,e.messages=C(this.messages),e.state=C(this.state),e.debug=this.debug,e.isRunning=this.isRunning,e.subscribers=[...this.subscribers],e}addMessage(e){this.messages.push(e),(async()=>{var n,t,r;for(let s of this.subscribers)await((n=s.onNewMessage)==null?void 0:n.call(s,{message:e,messages:this.messages,state:this.state,agent:this}));if(e.role==="assistant"&&e.toolCalls)for(let s of e.toolCalls)for(let a of this.subscribers)await((t=a.onNewToolCall)==null?void 0:t.call(a,{toolCall:s,messages:this.messages,state:this.state,agent:this}));for(let s of this.subscribers)await((r=s.onMessagesChanged)==null?void 0:r.call(s,{messages:this.messages,state:this.state,agent:this}))})()}addMessages(e){this.messages.push(...e),(async()=>{var n,t,r;for(let s of e){for(let a of this.subscribers)await((n=a.onNewMessage)==null?void 0:n.call(a,{message:s,messages:this.messages,state:this.state,agent:this}));if(s.role==="assistant"&&s.toolCalls)for(let a of s.toolCalls)for(let o of this.subscribers)await((t=o.onNewToolCall)==null?void 0:t.call(o,{toolCall:a,messages:this.messages,state:this.state,agent:this}))}for(let s of this.subscribers)await((r=s.onMessagesChanged)==null?void 0:r.call(s,{messages:this.messages,state:this.state,agent:this}))})()}setMessages(e){this.messages=C(e),(async()=>{var n;for(let t of this.subscribers)await((n=t.onMessagesChanged)==null?void 0:n.call(t,{messages:this.messages,state:this.state,agent:this}))})()}setState(e){this.state=C(e),(async()=>{var n;for(let t of this.subscribers)await((n=t.onStateChanged)==null?void 0:n.call(t,{messages:this.messages,state:this.state,agent:this}))})()}legacy_to_be_removed_runAgentBridged(e){var n;this.agentId=(n=this.agentId)!=null?n:se();let t=this.prepareRunAgentInput(e);return(this.middlewares.length===0?this.run(t):this.middlewares.reduceRight((r,s)=>({run:a=>s.run(a,r)}),this).run(t)).pipe(Ue(this.debug),rt(this.debug),Fa(this.threadId,t.runId,this.agentId),r=>r.pipe(ct(s=>(this.debug&&console.debug("[LEGACY]:",JSON.stringify(s)),s))))}},ja=class extends Ja{constructor(e){var n;super(e),this.abortController=new AbortController,this.url=e.url,this.headers=C((n=e.headers)!=null?n:{})}requestInit(e){return{method:"POST",headers:j(B({},this.headers),{"Content-Type":"application/json",Accept:"text/event-stream"}),body:JSON.stringify(e),signal:this.abortController.signal}}runAgent(e,n){var t;return this.abortController=(t=e?.abortController)!=null?t:new AbortController,super.runAgent(e,n)}abortRun(){this.abortController.abort(),super.abortRun()}run(e){let n=wa(this.url,this.requestInit(e));return Na(n)}clone(){var e;let n=super.clone();n.url=this.url,n.headers=C((e=this.headers)!=null?e:{});let t=new AbortController,r=this.abortController.signal;return r.aborted&&t.abort(r.reason),n.abortController=t,n}};function eo(e){let n=[],t=new Map,r=new Map;for(let s of e)if(s.type===c.TEXT_MESSAGE_START){let a=s,o=a.messageId;t.has(o)||t.set(o,{contents:[],otherEvents:[]});let i=t.get(o);i.start=a}else if(s.type===c.TEXT_MESSAGE_CONTENT){let a=s,o=a.messageId;t.has(o)||t.set(o,{contents:[],otherEvents:[]}),t.get(o).contents.push(a)}else if(s.type===c.TEXT_MESSAGE_END){let a=s,o=a.messageId;t.has(o)||t.set(o,{contents:[],otherEvents:[]});let i=t.get(o);i.end=a,Sn(o,i,n),t.delete(o)}else if(s.type===c.TOOL_CALL_START){let a=s,o=a.toolCallId;r.has(o)||r.set(o,{args:[],otherEvents:[]});let i=r.get(o);i.start=a}else if(s.type===c.TOOL_CALL_ARGS){let a=s,o=a.toolCallId;r.has(o)||r.set(o,{args:[],otherEvents:[]}),r.get(o).args.push(a)}else if(s.type===c.TOOL_CALL_END){let a=s,o=a.toolCallId;r.has(o)||r.set(o,{args:[],otherEvents:[]});let i=r.get(o);i.end=a,Tn(o,i,n),r.delete(o)}else{let a=!1;for(let[o,i]of t)if(i.start&&!i.end){i.otherEvents.push(s),a=!0;break}if(!a){for(let[o,i]of r)if(i.start&&!i.end){i.otherEvents.push(s),a=!0;break}}a||n.push(s)}for(let[s,a]of t)Sn(s,a,n);for(let[s,a]of r)Tn(s,a,n);return n}function Sn(e,n,t){if(n.start&&t.push(n.start),n.contents.length>0){let r=n.contents.map(a=>a.delta).join(""),s={type:c.TEXT_MESSAGE_CONTENT,messageId:e,delta:r};t.push(s)}n.end&&t.push(n.end);for(let r of n.otherEvents)t.push(r)}function Tn(e,n,t){if(n.start&&t.push(n.start),n.args.length>0){let r=n.args.map(a=>a.delta).join(""),s={type:c.TOOL_CALL_ARGS,toolCallId:e,delta:r};t.push(s)}n.end&&t.push(n.end);for(let r of n.otherEvents)t.push(r)}export{yt as AGUIConnectNotImplementedError,P as AGUIError,Ja as AbstractAgent,Wr as ActivityDeltaEventSchema,Nr as ActivityMessageSchema,Yr as ActivitySnapshotEventSchema,wr as AssistantMessageSchema,x as BaseEventSchema,$e as BaseMessageSchema,qa as BinaryInputContentSchema,Cr as ContextSchema,Zr as CustomEventSchema,Ir as DeveloperMessageSchema,Rn as EventSchemas,c as EventType,mr as FunctionCallSchema,ja as HttpAgent,_r as InputContentSchema,Nn as MessageSchema,zr as MessagesSnapshotEventSchema,qr as RawEventSchema,Za as RoleSchema,Rr as RunAgentInputSchema,es as RunErrorEventSchema,jr as RunFinishedEventSchema,Qr as RunStartedEventSchema,Jr as StateDeltaEventSchema,xr as StateSchema,$r as StateSnapshotEventSchema,ns as StepFinishedEventSchema,ts as StepStartedEventSchema,br as SystemMessageSchema,Sr as TextInputContentSchema,Lr as TextMessageChunkEventSchema,On as TextMessageContentEventSchema,Mr as TextMessageEndEventSchema,kr as TextMessageStartEventSchema,Kr as ThinkingEndEventSchema,Vr as ThinkingStartEventSchema,Dr as ThinkingTextMessageContentEventSchema,Gr as ThinkingTextMessageEndEventSchema,Pr as ThinkingTextMessageStartEventSchema,Hr as ToolCallArgsEventSchema,Xr as ToolCallChunkEventSchema,Fr as ToolCallEndEventSchema,Br as ToolCallResultEventSchema,gr as ToolCallSchema,Ur as ToolCallStartEventSchema,yr as ToolMessageSchema,Or as ToolSchema,Ar as UserMessageSchema,eo as compactEvents,Fa as convertToLegacyEvents,ur as defaultApplyEvents,ya as parseProtoStream,Aa as parseSSEStream,Qa as randomUUID,wa as runHttpRequest,C as structuredClone_,Ue as transformChunks,Na as transformHttpEventStream,rt as verifyEvents};
